!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PointEmitter=t():n.PointEmitter=t()}(this,(function(){return function(n){var t={};function c(e){if(t[e])return t[e].exports;var l=t[e]={i:e,l:!1,exports:{}};return n[e].call(l.exports,l,l.exports,c),l.l=!0,l.exports}return c.m=n,c.c=t,c.d=function(n,t,e){c.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:e})},c.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},c.t=function(n,t){if(1&t&&(n=c(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(c.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var l in n)c.d(e,l,function(t){return n[t]}.bind(null,l));return e},c.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return c.d(t,"a",t),t},c.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},c.p="",c(c.s=0)}([function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\nvar __assign = (undefined && undefined.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar EVENT_TYPE;\r\n(function (EVENT_TYPE) {\r\n    EVENT_TYPE["BEFORE_SELECT"] = "BEFORE_SELECT";\r\n    EVENT_TYPE["SELECT_START"] = "SELECT_START";\r\n    EVENT_TYPE["SELECTING"] = "SELECTING";\r\n    EVENT_TYPE["SELECT"] = "SELECT";\r\n    EVENT_TYPE["CLICK"] = "CLICK";\r\n    EVENT_TYPE["DB_CLICK"] = "DB_CLICK";\r\n    EVENT_TYPE["TOUCH_EDGES"] = "TOUCH_EDGES";\r\n    EVENT_TYPE["BEFORE_CREATE_GHOST"] = "BEFORE_CREATE_GHOST";\r\n    EVENT_TYPE["RESET"] = "RESET";\r\n})(EVENT_TYPE || (EVENT_TYPE = {}));\r\nvar DIRECTION;\r\n(function (DIRECTION) {\r\n    DIRECTION["TOP"] = "TOP";\r\n    DIRECTION["RIGHT"] = "RIGHT";\r\n    DIRECTION["BOTTOM"] = "BOTTOM";\r\n    DIRECTION["LEFT"] = "LEFT";\r\n})(DIRECTION || (DIRECTION = {}));\r\nvar PointEmitter = /** @class */ (function () {\r\n    function PointEmitter(node, _a) {\r\n        var _this = this;\r\n        var _b = _a === void 0 ? {} : _a, _c = _b.longPressThreshold, longPressThreshold = _c === void 0 ? 250 : _c, _d = _b.gridMovement, gridMovement = _d === void 0 ? 0 : _d, _e = _b.saveMouseCoords, saveMouseCoords = _e === void 0 ? false : _e, _f = _b.ghost, ghost = _f === void 0 ? { enable: false } : _f;\r\n        this.clickTolerance = 5;\r\n        this.clickInterval = 250;\r\n        this.currentWindowWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\r\n        this.currentWindowHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\r\n        this.destroy = function () {\r\n            _this.longPressThreshold = null;\r\n            _this.gridMovement = null;\r\n            _this.saveMouseCoords = null;\r\n            _this.ghost = null;\r\n            _this.bodyEl = null;\r\n            _this.node = null;\r\n            _this.listeners = Object.create(null);\r\n            _this.initialEventData = null;\r\n            _this.origDistanceFromXToNode = null;\r\n            _this.origDistanceFromYToNode = null;\r\n            _this.selecting = null;\r\n            _this.selectEventData = null;\r\n            _this.lastClickData = null;\r\n            _this.removeInitialEventListener && _this.removeInitialEventListener();\r\n            _this.removeMoveListener && _this.removeMoveListener();\r\n            _this.removeEndListener && _this.removeEndListener();\r\n            _this.removeKeyListener && _this.removeKeyListener();\r\n            _this.removeTouchMoveWindowListener && _this.removeTouchMoveWindowListener();\r\n        };\r\n        /* getter setter */\r\n        /* wrapper for add event listener */\r\n        this.listener = function (type, handler, target) {\r\n            target && target.addEventListener(type, handler, { passive: false });\r\n            !target && _this.node && _this.node.addEventListener(type, handler, { passive: false });\r\n            return function () {\r\n                target && target.removeEventListener(type, handler);\r\n                !target && _this.node && _this.node.removeEventListener(type, handler);\r\n            };\r\n        };\r\n        /* wrapper for add event listener */\r\n        /*  */\r\n        this.getBoundingRect = function (node) {\r\n            if (!node)\r\n                return;\r\n            var nodeBox = node.getBoundingClientRect();\r\n            return {\r\n                top: nodeBox.top + window.pageYOffset,\r\n                left: nodeBox.left + window.pageXOffset,\r\n                width: nodeBox.width,\r\n                height: nodeBox.height,\r\n            };\r\n        };\r\n        /*  */\r\n        /* Listen for mousedown & touchstart. When one is received, disabled the other and setup future event base on type */\r\n        this.onInitialEventListener = function () {\r\n            if (!_this.node)\r\n                return;\r\n            var removeTouchStartListener = _this.listener("touchstart", function (e) {\r\n                _this.removeInitialEventListener();\r\n                _this.removeInitialEventListener = _this.onAddLongPressListener(_this.onHandleEventListener, e);\r\n            });\r\n            var removeMouseDownListener = _this.listener("mousedown", function (e) {\r\n                _this.removeInitialEventListener();\r\n                _this.onHandleEventListener(e);\r\n                _this.removeInitialEventListener = _this.listener("mousedown", _this.onHandleEventListener);\r\n            });\r\n            _this.removeInitialEventListener = function () {\r\n                removeTouchStartListener();\r\n                removeMouseDownListener();\r\n            };\r\n        };\r\n        /* Listen for mousedown & touchstart. When one is received, disabled the other and setup future event base on type */\r\n        /* handling event */\r\n        this.onHandleEventListener = function (e) {\r\n            if (!_this.node)\r\n                return;\r\n            var _a = _this.getEventCoords(e), isTouch = _a.isTouch, x = _a.x, y = _a.y;\r\n            var _b = _this.getBoundingRect(_this.node), top = _b.top, left = _b.left;\r\n            _this.origDistanceFromYToNode = y - top;\r\n            _this.origDistanceFromXToNode = x - left;\r\n            _this.selectEventData = { x: x, y: y };\r\n            _this.initialEventData = { isTouch: isTouch, x: x, y: y };\r\n            _this.onCreateGhostEl(_this.node);\r\n            _this.emit(EVENT_TYPE.BEFORE_SELECT, _this.initialEventData);\r\n            switch (e.type) {\r\n                case "touchstart":\r\n                    _this.removeMoveListener = _this.listener("touchmove", _this.onMoveListener, window);\r\n                    _this.removeEndListener = _this.listener("touchend", _this.onEndListener, window);\r\n                    _this.removeKeyListener = _this.listener("keydown", _this.onEndListener, window);\r\n                    break;\r\n                case "mousedown":\r\n                    _this.removeMoveListener = _this.listener("mousemove", _this.onMoveListener, window);\r\n                    _this.removeEndListener = _this.listener("mouseup", _this.onEndListener, window);\r\n                    _this.removeKeyListener = _this.listener("keydown", _this.onEndListener, window);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        };\r\n        /* add long press listener if user touch the screen without moving their finger for 250ms */\r\n        this.onAddLongPressListener = function (handleEventListener, e) {\r\n            var longPressTimer = null;\r\n            var removeTouchMoveListener = null;\r\n            var removeToucEndListener = null;\r\n            var cleanup = function () {\r\n                longPressTimer && clearTimeout(longPressTimer);\r\n                removeTouchMoveListener && removeTouchMoveListener();\r\n                removeToucEndListener && removeToucEndListener();\r\n                longPressTimer = null;\r\n                removeTouchMoveListener = null;\r\n                removeToucEndListener = null;\r\n            };\r\n            var onTouchStart = function (e) {\r\n                longPressTimer = setTimeout(function () {\r\n                    cleanup();\r\n                    handleEventListener(e);\r\n                }, _this.longPressThreshold);\r\n                removeTouchMoveListener = _this.listener("touchmove", function () { return cleanup(); });\r\n                removeToucEndListener = _this.listener("touchend", function () { return cleanup(); });\r\n            };\r\n            var removeTouchStartListener = _this.listener("touchstart", onTouchStart);\r\n            e && onTouchStart(e);\r\n            return function () {\r\n                cleanup();\r\n                removeTouchStartListener();\r\n            };\r\n        };\r\n        this.onMoveListener = function (e) {\r\n            if (!_this.initialEventData)\r\n                return;\r\n            var _a = _this.initialEventData, initX = _a.x, initY = _a.y;\r\n            var _b = _this.getEventCoords(e), x = _b.x, y = _b.y;\r\n            var origSelecting = _this.selecting, distanceFromInitXToX = Math.abs(initX - x), distanceFromInitYToY = Math.abs(initY - y), click = _this.isClick(x, y);\r\n            // Prevent emitting selectStart event until mouse is moved.\r\n            // in Chrome on Windows, mouseMove event may be fired just after mouseDown event.\r\n            if (_this.isClick(x, y) && !origSelecting && !(distanceFromInitXToX || distanceFromInitYToY))\r\n                return;\r\n            var afterX = x;\r\n            var afterY = y;\r\n            if (_this.saveMouseCoords) {\r\n                afterX = x - _this.origDistanceFromXToNode;\r\n                afterY = y - _this.origDistanceFromYToNode;\r\n            }\r\n            if (_this.gridMovement) {\r\n                afterX = _this.calcGridMovement(afterX);\r\n                afterY = _this.calcGridMovement(afterY);\r\n            }\r\n            _this.selectEventData = { x: afterX, y: afterY };\r\n            _this.selecting = true;\r\n            !origSelecting && _this.emit(EVENT_TYPE.SELECT_START, { x: initX, y: initY });\r\n            !click && _this.emit(EVENT_TYPE.SELECTING, _this.selectEventData);\r\n            var _c = _this.touchEdges(x, y), touch = _c.touch, dir = _c.dir;\r\n            if (touch) {\r\n                return _this.emit(EVENT_TYPE.TOUCH_EDGES, __assign(__assign({}, _this.selectEventData), { dir: dir }));\r\n            }\r\n            e.preventDefault();\r\n        };\r\n        this.onEndListener = function (e) {\r\n            if (!_this.initialEventData)\r\n                return;\r\n            _this.onDelGhostEl();\r\n            _this.removeMoveListener && _this.removeMoveListener();\r\n            _this.removeEndListener && _this.removeEndListener();\r\n            _this.removeKeyListener && _this.removeKeyListener();\r\n            _this.selecting = false;\r\n            var inRoot = _this.node.contains(e.target);\r\n            var _a = _this.getEventCoords(e), x = _a.x, y = _a.y;\r\n            var click = _this.isClick(x, y);\r\n            if (e.key) {\r\n                return _this.emit(EVENT_TYPE.RESET, _this.selectEventData);\r\n            }\r\n            if (click && inRoot)\r\n                return _this.onClickListener(e);\r\n            if (!click)\r\n                return _this.emit(EVENT_TYPE.SELECT, _this.selectEventData);\r\n        };\r\n        this.onClickListener = function (e) {\r\n            var _a = _this.getEventCoords(e), x = _a.x, y = _a.y;\r\n            var now = new Date().getTime();\r\n            if (_this.lastClickData && now - _this.lastClickData <= _this.clickInterval) {\r\n                _this.lastClickData = null;\r\n                return _this.emit(EVENT_TYPE.DB_CLICK, { x: x, y: y });\r\n            }\r\n            _this.lastClickData = now;\r\n            return _this.emit(EVENT_TYPE.CLICK, { x: x, y: y });\r\n        };\r\n        this.getEventCoords = function (e) {\r\n            var coords = {\r\n                isTouch: false,\r\n                x: e.pageX,\r\n                y: e.pageY,\r\n            };\r\n            /* if (e.touches && e.touches.length) {\r\n              coords.isTouch = true;\r\n              coords.x = e.touches[0].pageX;\r\n              coords.y = e.touches[0].pageY;\r\n            } */\r\n            /* try new way =)) */\r\n            e.touches &&\r\n                e.touches.length &&\r\n                ((coords.isTouch = true), (coords.x = e.touches[0].pageX), (coords.y = e.touches[0].pageY));\r\n            return coords;\r\n        };\r\n        this.isClick = function (currX, currY) {\r\n            var _a = _this.initialEventData, isTouch = _a.isTouch, x = _a.x, y = _a.y;\r\n            return !isTouch && Math.abs(currX - x) <= _this.clickTolerance && Math.abs(currY - y) <= _this.clickTolerance;\r\n        };\r\n        this.touchEdges = function (x, y) {\r\n            var _a = _this.getBoundingRect(_this.node), width = _a.width, height = _a.height;\r\n            var afterX = x;\r\n            var afterY = y;\r\n            if (_this.saveMouseCoords) {\r\n                afterX = x - _this.origDistanceFromXToNode;\r\n                afterY = y - _this.origDistanceFromYToNode;\r\n            }\r\n            if (afterX < 0) {\r\n                return { touch: true, dir: DIRECTION.LEFT };\r\n            }\r\n            if (afterX + width > _this.currentWindowWidth) {\r\n                return { touch: true, dir: DIRECTION.RIGHT };\r\n            }\r\n            if (afterY < 0) {\r\n                return { touch: true, dir: DIRECTION.TOP };\r\n            }\r\n            if (afterY + height > _this.currentWindowHeight) {\r\n                return { touch: true, dir: DIRECTION.BOTTOM };\r\n            }\r\n            return { touch: false, dir: null };\r\n        };\r\n        this.calcGridMovement = function (currPosition) {\r\n            return Math.floor(currPosition / _this.gridMovement) * _this.gridMovement;\r\n        };\r\n        /* handling event */\r\n        /* DOM manipulation */\r\n        this.onCreateGhostEl = function (node) {\r\n            // create ghost el\r\n            if (_this.ghost && _this.ghost.enable) {\r\n                var ghost = node.cloneNode(true);\r\n                ghost.id = "pe-ghost";\r\n                if (_this.ghost.style) {\r\n                    for (var s in _this.ghost.style) {\r\n                        if (_this.ghost.style[s]) {\r\n                            ghost.style[s] = _this.ghost.style[s];\r\n                        }\r\n                    }\r\n                }\r\n                _this.emit(EVENT_TYPE.BEFORE_CREATE_GHOST, ghost);\r\n                _this.bodyEl.insertBefore(ghost, node);\r\n            }\r\n        };\r\n        this.onDelGhostEl = function () { return _this.ghost && _this.ghost.enable && document.querySelector("#pe-ghost").remove(); };\r\n        /* DOM manipulation */\r\n        /* Inspire by EventEmiiter, turnsout it\'s PubSub pattern */\r\n        this.on = function (type, handler) {\r\n            var idx = (_this.listeners[type] || (_this.listeners[type] = [])).push(handler) - 1;\r\n            return {\r\n                off: function () {\r\n                    this.listeners[type].splice(idx, 1);\r\n                },\r\n            };\r\n        };\r\n        this.emit = function (type) {\r\n            var args = [];\r\n            for (var _i = 1; _i < arguments.length; _i++) {\r\n                args[_i - 1] = arguments[_i];\r\n            }\r\n            (_this.listeners[type] || []).forEach(function (fn) {\r\n                fn.apply(void 0, args);\r\n            });\r\n        };\r\n        this.longPressThreshold = longPressThreshold;\r\n        this.gridMovement = gridMovement;\r\n        this.saveMouseCoords = saveMouseCoords;\r\n        this.ghost = ghost;\r\n        this.bodyEl = document.querySelector("body");\r\n        this.node = node;\r\n        this.listeners = Object.create(null);\r\n        this.selecting = false;\r\n        // Fixes an iOS 10 bug where scrolling could not be prevented on the window.\r\n        this.removeTouchMoveWindowListener = this.listener("touchmove", function () { }, window);\r\n        this.onInitialEventListener();\r\n    }\r\n    Object.defineProperty(PointEmitter.prototype, "getNode", {\r\n        /* getter setter */\r\n        get: function () {\r\n            return this.node;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(PointEmitter.prototype, "getListeners", {\r\n        get: function () {\r\n            return this.listeners;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return PointEmitter;\r\n}());\r\n/* harmony default export */ __webpack_exports__["default"] = (PointEmitter);\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1BvaW50RW1pdHRlci8uL3NyYy9pbmRleC50cz9mZmI0Il0sInNvdXJjZXNDb250ZW50IjpbImVudW0gRVZFTlRfVFlQRSB7XHJcbiAgQkVGT1JFX1NFTEVDVCA9IFwiQkVGT1JFX1NFTEVDVFwiLFxyXG4gIFNFTEVDVF9TVEFSVCA9IFwiU0VMRUNUX1NUQVJUXCIsXHJcbiAgU0VMRUNUSU5HID0gXCJTRUxFQ1RJTkdcIixcclxuICBTRUxFQ1QgPSBcIlNFTEVDVFwiLFxyXG4gIENMSUNLID0gXCJDTElDS1wiLFxyXG4gIERCX0NMSUNLID0gXCJEQl9DTElDS1wiLFxyXG4gIFRPVUNIX0VER0VTID0gXCJUT1VDSF9FREdFU1wiLFxyXG4gIEJFRk9SRV9DUkVBVEVfR0hPU1QgPSBcIkJFRk9SRV9DUkVBVEVfR0hPU1RcIixcclxuICBSRVNFVCA9IFwiUkVTRVRcIixcclxufVxyXG5cclxuZW51bSBESVJFQ1RJT04ge1xyXG4gIFRPUCA9IFwiVE9QXCIsXHJcbiAgUklHSFQgPSBcIlJJR0hUXCIsXHJcbiAgQk9UVE9NID0gXCJCT1RUT01cIixcclxuICBMRUZUID0gXCJMRUZUXCIsXHJcbn1cclxuXHJcbnR5cGUgUG9pbnREYXRhID0ge1xyXG4gIHg6IG51bWJlcjtcclxuICB5OiBudW1iZXI7XHJcbn07XHJcblxyXG50eXBlIEVkZ2VEYXRhID0gUG9pbnREYXRhICYge1xyXG4gIGRpcjogRElSRUNUSU9OO1xyXG59O1xyXG5cclxudHlwZSBFdmVudERhdGEgPSBQb2ludERhdGEgJiB7XHJcbiAgaXNUb3VjaDogYm9vbGVhbjtcclxufTtcclxuXHJcbnR5cGUgQm94RGF0YSA9IHtcclxuICB0b3A6IG51bWJlcjtcclxuICBsZWZ0OiBudW1iZXI7XHJcbiAgd2lkdGg6IG51bWJlcjtcclxuICBoZWlnaHQ6IG51bWJlcjtcclxufTtcclxuXHJcbnR5cGUgTGlzdGVuZXJEYXRhID0geyBba2V5OiBzdHJpbmddOiBGdW5jdGlvbltdIH07XHJcblxyXG50eXBlIEdob3N0ID0ge1xyXG4gIGVuYWJsZTogYm9vbGVhbjtcclxuICBzdHlsZT86IENTU1N0eWxlRGVjbGFyYXRpb247XHJcbn07XHJcblxyXG5jbGFzcyBQb2ludEVtaXR0ZXIge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY2xpY2tUb2xlcmFuY2U6IG51bWJlciA9IDU7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBjbGlja0ludGVydmFsOiBudW1iZXIgPSAyNTA7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgY3VycmVudFdpbmRvd1dpZHRoOiBudW1iZXIgPVxyXG4gICAgd2luZG93LmlubmVyV2lkdGggfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIHx8IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgY3VycmVudFdpbmRvd0hlaWdodDogbnVtYmVyID1cclxuICAgIHdpbmRvdy5pbm5lckhlaWdodCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IHx8IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0O1xyXG5cclxuICBwcml2YXRlIGxvbmdQcmVzc1RocmVzaG9sZDogbnVtYmVyIHwgbnVsbDtcclxuICBwcml2YXRlIGdyaWRNb3ZlbWVudDogbnVtYmVyIHwgbnVsbDtcclxuICBwcml2YXRlIHNhdmVNb3VzZUNvb3JkczogYm9vbGVhbiB8IG51bGw7XHJcbiAgcHJpdmF0ZSBnaG9zdDogR2hvc3QgfCBudWxsO1xyXG5cclxuICBwcml2YXRlIGJvZHlFbDogSFRNTEJvZHlFbGVtZW50IHwgbnVsbDtcclxuXHJcbiAgcHJpdmF0ZSBub2RlOiBFbGVtZW50IHwgbnVsbDtcclxuICBwcml2YXRlIGxpc3RlbmVyczogTGlzdGVuZXJEYXRhO1xyXG4gIHByaXZhdGUgaW5pdGlhbEV2ZW50RGF0YTogRXZlbnREYXRhIHwgbnVsbDtcclxuICBwcml2YXRlIG9yaWdEaXN0YW5jZUZyb21YVG9Ob2RlOiBudW1iZXIgfCBudWxsO1xyXG4gIHByaXZhdGUgb3JpZ0Rpc3RhbmNlRnJvbVlUb05vZGU6IG51bWJlciB8IG51bGw7XHJcbiAgcHJpdmF0ZSBzZWxlY3Rpbmc6IGJvb2xlYW4gfCBudWxsO1xyXG4gIHByaXZhdGUgc2VsZWN0RXZlbnREYXRhOiBQb2ludERhdGEgfCBudWxsOyAvLyBzYXZlIGN1cnJYICYgY3VyclkgZm9yIFNFTEVDVElORyAmIFNFTEVDVCB0eXBlIGNhdXNlIFwidG91Y2hFbmRcIiBkb2Vzbid0IGhhdmUgXCJwYWdlWCwgcGFnZVlcIlxyXG4gIHByaXZhdGUgbGFzdENsaWNrRGF0YTogbnVtYmVyIHwgbnVsbDsgLy8gc2F2ZSBsYXN0IGNsaWNrIHRvIGNvbXBhcmUgd2l0aCBsYXRlc3QgY2xpY2sgZm9yIERCX0NMSUNLIHR5cGVcclxuXHJcbiAgcHJpdmF0ZSByZW1vdmVJbml0aWFsRXZlbnRMaXN0ZW5lcjogRnVuY3Rpb247XHJcbiAgcHJpdmF0ZSByZW1vdmVNb3ZlTGlzdGVuZXI6IEZ1bmN0aW9uO1xyXG4gIHByaXZhdGUgcmVtb3ZlRW5kTGlzdGVuZXI6IEZ1bmN0aW9uO1xyXG4gIHByaXZhdGUgcmVtb3ZlS2V5TGlzdGVuZXI6IEZ1bmN0aW9uO1xyXG4gIHByaXZhdGUgcmVtb3ZlVG91Y2hNb3ZlV2luZG93TGlzdGVuZXI6IEZ1bmN0aW9uO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIG5vZGU6IEVsZW1lbnQgfCBudWxsLFxyXG4gICAgeyBsb25nUHJlc3NUaHJlc2hvbGQgPSAyNTAsIGdyaWRNb3ZlbWVudCA9IDAsIHNhdmVNb3VzZUNvb3JkcyA9IGZhbHNlLCBnaG9zdCA9IHsgZW5hYmxlOiBmYWxzZSB9IH0gPSB7fVxyXG4gICkge1xyXG4gICAgdGhpcy5sb25nUHJlc3NUaHJlc2hvbGQgPSBsb25nUHJlc3NUaHJlc2hvbGQ7XHJcbiAgICB0aGlzLmdyaWRNb3ZlbWVudCA9IGdyaWRNb3ZlbWVudDtcclxuICAgIHRoaXMuc2F2ZU1vdXNlQ29vcmRzID0gc2F2ZU1vdXNlQ29vcmRzO1xyXG4gICAgdGhpcy5naG9zdCA9IGdob3N0O1xyXG5cclxuICAgIHRoaXMuYm9keUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIik7XHJcblxyXG4gICAgdGhpcy5ub2RlID0gbm9kZTtcclxuICAgIHRoaXMubGlzdGVuZXJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgIHRoaXMuc2VsZWN0aW5nID0gZmFsc2U7XHJcblxyXG4gICAgLy8gRml4ZXMgYW4gaU9TIDEwIGJ1ZyB3aGVyZSBzY3JvbGxpbmcgY291bGQgbm90IGJlIHByZXZlbnRlZCBvbiB0aGUgd2luZG93LlxyXG4gICAgdGhpcy5yZW1vdmVUb3VjaE1vdmVXaW5kb3dMaXN0ZW5lciA9IHRoaXMubGlzdGVuZXIoXCJ0b3VjaG1vdmVcIiwgKCkgPT4ge30sIHdpbmRvdyk7XHJcblxyXG4gICAgdGhpcy5vbkluaXRpYWxFdmVudExpc3RlbmVyKCk7XHJcbiAgfVxyXG5cclxuICBkZXN0cm95ID0gKCkgPT4ge1xyXG4gICAgdGhpcy5sb25nUHJlc3NUaHJlc2hvbGQgPSBudWxsO1xyXG4gICAgdGhpcy5ncmlkTW92ZW1lbnQgPSBudWxsO1xyXG4gICAgdGhpcy5zYXZlTW91c2VDb29yZHMgPSBudWxsO1xyXG4gICAgdGhpcy5naG9zdCA9IG51bGw7XHJcblxyXG4gICAgdGhpcy5ib2R5RWwgPSBudWxsO1xyXG5cclxuICAgIHRoaXMubm9kZSA9IG51bGw7XHJcbiAgICB0aGlzLmxpc3RlbmVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICB0aGlzLmluaXRpYWxFdmVudERhdGEgPSBudWxsO1xyXG4gICAgdGhpcy5vcmlnRGlzdGFuY2VGcm9tWFRvTm9kZSA9IG51bGw7XHJcbiAgICB0aGlzLm9yaWdEaXN0YW5jZUZyb21ZVG9Ob2RlID0gbnVsbDtcclxuICAgIHRoaXMuc2VsZWN0aW5nID0gbnVsbDtcclxuICAgIHRoaXMuc2VsZWN0RXZlbnREYXRhID0gbnVsbDtcclxuICAgIHRoaXMubGFzdENsaWNrRGF0YSA9IG51bGw7XHJcblxyXG4gICAgdGhpcy5yZW1vdmVJbml0aWFsRXZlbnRMaXN0ZW5lciAmJiB0aGlzLnJlbW92ZUluaXRpYWxFdmVudExpc3RlbmVyKCk7XHJcbiAgICB0aGlzLnJlbW92ZU1vdmVMaXN0ZW5lciAmJiB0aGlzLnJlbW92ZU1vdmVMaXN0ZW5lcigpO1xyXG4gICAgdGhpcy5yZW1vdmVFbmRMaXN0ZW5lciAmJiB0aGlzLnJlbW92ZUVuZExpc3RlbmVyKCk7XHJcbiAgICB0aGlzLnJlbW92ZUtleUxpc3RlbmVyICYmIHRoaXMucmVtb3ZlS2V5TGlzdGVuZXIoKTtcclxuICAgIHRoaXMucmVtb3ZlVG91Y2hNb3ZlV2luZG93TGlzdGVuZXIgJiYgdGhpcy5yZW1vdmVUb3VjaE1vdmVXaW5kb3dMaXN0ZW5lcigpO1xyXG4gIH07XHJcbiAgLyogZ2V0dGVyIHNldHRlciAqL1xyXG4gIGdldCBnZXROb2RlKCk6IEVsZW1lbnQge1xyXG4gICAgcmV0dXJuIHRoaXMubm9kZTtcclxuICB9XHJcblxyXG4gIGdldCBnZXRMaXN0ZW5lcnMoKTogTGlzdGVuZXJEYXRhIHtcclxuICAgIHJldHVybiB0aGlzLmxpc3RlbmVycztcclxuICB9XHJcbiAgLyogZ2V0dGVyIHNldHRlciAqL1xyXG5cclxuICAvKiB3cmFwcGVyIGZvciBhZGQgZXZlbnQgbGlzdGVuZXIgKi9cclxuICBwcml2YXRlIGxpc3RlbmVyID0gKHR5cGU6IHN0cmluZywgaGFuZGxlcjogRXZlbnRMaXN0ZW5lck9yRXZlbnRMaXN0ZW5lck9iamVjdCwgdGFyZ2V0PzogYW55KSA9PiB7XHJcbiAgICB0YXJnZXQgJiYgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlciwgeyBwYXNzaXZlOiBmYWxzZSB9KTtcclxuICAgICF0YXJnZXQgJiYgdGhpcy5ub2RlICYmIHRoaXMubm9kZS5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGhhbmRsZXIsIHsgcGFzc2l2ZTogZmFsc2UgfSk7XHJcblxyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgdGFyZ2V0ICYmIHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGhhbmRsZXIpO1xyXG4gICAgICAhdGFyZ2V0ICYmIHRoaXMubm9kZSAmJiB0aGlzLm5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBoYW5kbGVyKTtcclxuICAgIH07XHJcbiAgfTtcclxuICAvKiB3cmFwcGVyIGZvciBhZGQgZXZlbnQgbGlzdGVuZXIgKi9cclxuXHJcbiAgLyogICovXHJcbiAgcHJpdmF0ZSBnZXRCb3VuZGluZ1JlY3QgPSAobm9kZTogRWxlbWVudCk6IEJveERhdGEgPT4ge1xyXG4gICAgaWYgKCFub2RlKSByZXR1cm47XHJcblxyXG4gICAgY29uc3Qgbm9kZUJveDogRE9NUmVjdCA9IG5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b3A6IG5vZGVCb3gudG9wICsgd2luZG93LnBhZ2VZT2Zmc2V0LFxyXG4gICAgICBsZWZ0OiBub2RlQm94LmxlZnQgKyB3aW5kb3cucGFnZVhPZmZzZXQsXHJcbiAgICAgIHdpZHRoOiBub2RlQm94LndpZHRoLFxyXG4gICAgICBoZWlnaHQ6IG5vZGVCb3guaGVpZ2h0LFxyXG4gICAgfTtcclxuICB9O1xyXG4gIC8qICAqL1xyXG5cclxuICAvKiBMaXN0ZW4gZm9yIG1vdXNlZG93biAmIHRvdWNoc3RhcnQuIFdoZW4gb25lIGlzIHJlY2VpdmVkLCBkaXNhYmxlZCB0aGUgb3RoZXIgYW5kIHNldHVwIGZ1dHVyZSBldmVudCBiYXNlIG9uIHR5cGUgKi9cclxuICBwcml2YXRlIG9uSW5pdGlhbEV2ZW50TGlzdGVuZXIgPSAoKTogdm9pZCA9PiB7XHJcbiAgICBpZiAoIXRoaXMubm9kZSkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IHJlbW92ZVRvdWNoU3RhcnRMaXN0ZW5lciA9IHRoaXMubGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIChlKSA9PiB7XHJcbiAgICAgIHRoaXMucmVtb3ZlSW5pdGlhbEV2ZW50TGlzdGVuZXIoKTtcclxuICAgICAgdGhpcy5yZW1vdmVJbml0aWFsRXZlbnRMaXN0ZW5lciA9IHRoaXMub25BZGRMb25nUHJlc3NMaXN0ZW5lcih0aGlzLm9uSGFuZGxlRXZlbnRMaXN0ZW5lciwgZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCByZW1vdmVNb3VzZURvd25MaXN0ZW5lciA9IHRoaXMubGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcclxuICAgICAgdGhpcy5yZW1vdmVJbml0aWFsRXZlbnRMaXN0ZW5lcigpO1xyXG4gICAgICB0aGlzLm9uSGFuZGxlRXZlbnRMaXN0ZW5lcihlKTtcclxuICAgICAgdGhpcy5yZW1vdmVJbml0aWFsRXZlbnRMaXN0ZW5lciA9IHRoaXMubGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5vbkhhbmRsZUV2ZW50TGlzdGVuZXIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5yZW1vdmVJbml0aWFsRXZlbnRMaXN0ZW5lciA9ICgpID0+IHtcclxuICAgICAgcmVtb3ZlVG91Y2hTdGFydExpc3RlbmVyKCk7XHJcbiAgICAgIHJlbW92ZU1vdXNlRG93bkxpc3RlbmVyKCk7XHJcbiAgICB9O1xyXG4gIH07XHJcbiAgLyogTGlzdGVuIGZvciBtb3VzZWRvd24gJiB0b3VjaHN0YXJ0LiBXaGVuIG9uZSBpcyByZWNlaXZlZCwgZGlzYWJsZWQgdGhlIG90aGVyIGFuZCBzZXR1cCBmdXR1cmUgZXZlbnQgYmFzZSBvbiB0eXBlICovXHJcblxyXG4gIC8qIGhhbmRsaW5nIGV2ZW50ICovXHJcbiAgcHJpdmF0ZSBvbkhhbmRsZUV2ZW50TGlzdGVuZXIgPSAoZTogYW55KSA9PiB7XHJcbiAgICBpZiAoIXRoaXMubm9kZSkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IHsgaXNUb3VjaCwgeCwgeSB9ID0gdGhpcy5nZXRFdmVudENvb3JkcyhlKTtcclxuICAgIGNvbnN0IHsgdG9wLCBsZWZ0IH0gPSB0aGlzLmdldEJvdW5kaW5nUmVjdCh0aGlzLm5vZGUpO1xyXG4gICAgdGhpcy5vcmlnRGlzdGFuY2VGcm9tWVRvTm9kZSA9IHkgLSB0b3A7XHJcbiAgICB0aGlzLm9yaWdEaXN0YW5jZUZyb21YVG9Ob2RlID0geCAtIGxlZnQ7XHJcbiAgICB0aGlzLnNlbGVjdEV2ZW50RGF0YSA9IHsgeCwgeSB9O1xyXG4gICAgdGhpcy5pbml0aWFsRXZlbnREYXRhID0geyBpc1RvdWNoLCB4LCB5IH07XHJcblxyXG4gICAgdGhpcy5vbkNyZWF0ZUdob3N0RWwodGhpcy5ub2RlKTtcclxuICAgIHRoaXMuZW1pdChFVkVOVF9UWVBFLkJFRk9SRV9TRUxFQ1QsIHRoaXMuaW5pdGlhbEV2ZW50RGF0YSk7XHJcblxyXG4gICAgc3dpdGNoIChlLnR5cGUpIHtcclxuICAgICAgY2FzZSBcInRvdWNoc3RhcnRcIjpcclxuICAgICAgICB0aGlzLnJlbW92ZU1vdmVMaXN0ZW5lciA9IHRoaXMubGlzdGVuZXIoXCJ0b3VjaG1vdmVcIiwgdGhpcy5vbk1vdmVMaXN0ZW5lciwgd2luZG93KTtcclxuICAgICAgICB0aGlzLnJlbW92ZUVuZExpc3RlbmVyID0gdGhpcy5saXN0ZW5lcihcInRvdWNoZW5kXCIsIHRoaXMub25FbmRMaXN0ZW5lciwgd2luZG93KTtcclxuICAgICAgICB0aGlzLnJlbW92ZUtleUxpc3RlbmVyID0gdGhpcy5saXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5vbkVuZExpc3RlbmVyLCB3aW5kb3cpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIFwibW91c2Vkb3duXCI6XHJcbiAgICAgICAgdGhpcy5yZW1vdmVNb3ZlTGlzdGVuZXIgPSB0aGlzLmxpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMub25Nb3ZlTGlzdGVuZXIsIHdpbmRvdyk7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVFbmRMaXN0ZW5lciA9IHRoaXMubGlzdGVuZXIoXCJtb3VzZXVwXCIsIHRoaXMub25FbmRMaXN0ZW5lciwgd2luZG93KTtcclxuICAgICAgICB0aGlzLnJlbW92ZUtleUxpc3RlbmVyID0gdGhpcy5saXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5vbkVuZExpc3RlbmVyLCB3aW5kb3cpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIC8qIGFkZCBsb25nIHByZXNzIGxpc3RlbmVyIGlmIHVzZXIgdG91Y2ggdGhlIHNjcmVlbiB3aXRob3V0IG1vdmluZyB0aGVpciBmaW5nZXIgZm9yIDI1MG1zICovXHJcbiAgcHJpdmF0ZSBvbkFkZExvbmdQcmVzc0xpc3RlbmVyID0gKGhhbmRsZUV2ZW50TGlzdGVuZXI6IEZ1bmN0aW9uLCBlOiBhbnkpID0+IHtcclxuICAgIGxldCBsb25nUHJlc3NUaW1lcjogbnVtYmVyIHwgbnVsbCA9IG51bGw7XHJcbiAgICBsZXQgcmVtb3ZlVG91Y2hNb3ZlTGlzdGVuZXI6IEZ1bmN0aW9uIHwgbnVsbCA9IG51bGw7XHJcbiAgICBsZXQgcmVtb3ZlVG91Y0VuZExpc3RlbmVyOiBGdW5jdGlvbiB8IG51bGwgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0IGNsZWFudXAgPSAoKSA9PiB7XHJcbiAgICAgIGxvbmdQcmVzc1RpbWVyICYmIGNsZWFyVGltZW91dChsb25nUHJlc3NUaW1lcik7XHJcbiAgICAgIHJlbW92ZVRvdWNoTW92ZUxpc3RlbmVyICYmIHJlbW92ZVRvdWNoTW92ZUxpc3RlbmVyKCk7XHJcbiAgICAgIHJlbW92ZVRvdWNFbmRMaXN0ZW5lciAmJiByZW1vdmVUb3VjRW5kTGlzdGVuZXIoKTtcclxuXHJcbiAgICAgIGxvbmdQcmVzc1RpbWVyID0gbnVsbDtcclxuICAgICAgcmVtb3ZlVG91Y2hNb3ZlTGlzdGVuZXIgPSBudWxsO1xyXG4gICAgICByZW1vdmVUb3VjRW5kTGlzdGVuZXIgPSBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBvblRvdWNoU3RhcnQgPSAoZTogYW55KSA9PiB7XHJcbiAgICAgIGxvbmdQcmVzc1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgY2xlYW51cCgpO1xyXG4gICAgICAgIGhhbmRsZUV2ZW50TGlzdGVuZXIoZSk7XHJcbiAgICAgIH0sIHRoaXMubG9uZ1ByZXNzVGhyZXNob2xkKTtcclxuICAgICAgcmVtb3ZlVG91Y2hNb3ZlTGlzdGVuZXIgPSB0aGlzLmxpc3RlbmVyKFwidG91Y2htb3ZlXCIsICgpID0+IGNsZWFudXAoKSk7XHJcbiAgICAgIHJlbW92ZVRvdWNFbmRMaXN0ZW5lciA9IHRoaXMubGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCAoKSA9PiBjbGVhbnVwKCkpO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByZW1vdmVUb3VjaFN0YXJ0TGlzdGVuZXIgPSB0aGlzLmxpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBvblRvdWNoU3RhcnQpO1xyXG5cclxuICAgIGUgJiYgb25Ub3VjaFN0YXJ0KGUpO1xyXG5cclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGNsZWFudXAoKTtcclxuICAgICAgcmVtb3ZlVG91Y2hTdGFydExpc3RlbmVyKCk7XHJcbiAgICB9O1xyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgb25Nb3ZlTGlzdGVuZXIgPSAoZTogYW55KSA9PiB7XHJcbiAgICBpZiAoIXRoaXMuaW5pdGlhbEV2ZW50RGF0YSkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IHsgeDogaW5pdFgsIHk6IGluaXRZIH0gPSB0aGlzLmluaXRpYWxFdmVudERhdGE7XHJcbiAgICBjb25zdCB7IHgsIHkgfSA9IHRoaXMuZ2V0RXZlbnRDb29yZHMoZSk7XHJcbiAgICBjb25zdCBvcmlnU2VsZWN0aW5nOiBib29sZWFuID0gdGhpcy5zZWxlY3RpbmcsXHJcbiAgICAgIGRpc3RhbmNlRnJvbUluaXRYVG9YOiBudW1iZXIgPSBNYXRoLmFicyhpbml0WCAtIHgpLFxyXG4gICAgICBkaXN0YW5jZUZyb21Jbml0WVRvWTogbnVtYmVyID0gTWF0aC5hYnMoaW5pdFkgLSB5KSxcclxuICAgICAgY2xpY2sgPSB0aGlzLmlzQ2xpY2soeCwgeSk7XHJcblxyXG4gICAgLy8gUHJldmVudCBlbWl0dGluZyBzZWxlY3RTdGFydCBldmVudCB1bnRpbCBtb3VzZSBpcyBtb3ZlZC5cclxuICAgIC8vIGluIENocm9tZSBvbiBXaW5kb3dzLCBtb3VzZU1vdmUgZXZlbnQgbWF5IGJlIGZpcmVkIGp1c3QgYWZ0ZXIgbW91c2VEb3duIGV2ZW50LlxyXG4gICAgaWYgKHRoaXMuaXNDbGljayh4LCB5KSAmJiAhb3JpZ1NlbGVjdGluZyAmJiAhKGRpc3RhbmNlRnJvbUluaXRYVG9YIHx8IGRpc3RhbmNlRnJvbUluaXRZVG9ZKSkgcmV0dXJuO1xyXG5cclxuICAgIGxldCBhZnRlclg6IG51bWJlciA9IHg7XHJcbiAgICBsZXQgYWZ0ZXJZOiBudW1iZXIgPSB5O1xyXG4gICAgaWYgKHRoaXMuc2F2ZU1vdXNlQ29vcmRzKSB7XHJcbiAgICAgIGFmdGVyWCA9IHggLSB0aGlzLm9yaWdEaXN0YW5jZUZyb21YVG9Ob2RlO1xyXG4gICAgICBhZnRlclkgPSB5IC0gdGhpcy5vcmlnRGlzdGFuY2VGcm9tWVRvTm9kZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5ncmlkTW92ZW1lbnQpIHtcclxuICAgICAgYWZ0ZXJYID0gdGhpcy5jYWxjR3JpZE1vdmVtZW50KGFmdGVyWCk7XHJcbiAgICAgIGFmdGVyWSA9IHRoaXMuY2FsY0dyaWRNb3ZlbWVudChhZnRlclkpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2VsZWN0RXZlbnREYXRhID0geyB4OiBhZnRlclgsIHk6IGFmdGVyWSB9O1xyXG4gICAgdGhpcy5zZWxlY3RpbmcgPSB0cnVlO1xyXG5cclxuICAgICFvcmlnU2VsZWN0aW5nICYmIHRoaXMuZW1pdChFVkVOVF9UWVBFLlNFTEVDVF9TVEFSVCwgeyB4OiBpbml0WCwgeTogaW5pdFkgfSk7XHJcbiAgICAhY2xpY2sgJiYgdGhpcy5lbWl0KEVWRU5UX1RZUEUuU0VMRUNUSU5HLCB0aGlzLnNlbGVjdEV2ZW50RGF0YSk7XHJcblxyXG4gICAgY29uc3QgeyB0b3VjaCwgZGlyIH0gPSB0aGlzLnRvdWNoRWRnZXMoeCwgeSk7XHJcbiAgICBpZiAodG91Y2gpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZW1pdChFVkVOVF9UWVBFLlRPVUNIX0VER0VTLCB7IC4uLnRoaXMuc2VsZWN0RXZlbnREYXRhLCBkaXIgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgb25FbmRMaXN0ZW5lciA9IChlOiBhbnkpID0+IHtcclxuICAgIGlmICghdGhpcy5pbml0aWFsRXZlbnREYXRhKSByZXR1cm47XHJcblxyXG4gICAgdGhpcy5vbkRlbEdob3N0RWwoKTtcclxuXHJcbiAgICB0aGlzLnJlbW92ZU1vdmVMaXN0ZW5lciAmJiB0aGlzLnJlbW92ZU1vdmVMaXN0ZW5lcigpO1xyXG4gICAgdGhpcy5yZW1vdmVFbmRMaXN0ZW5lciAmJiB0aGlzLnJlbW92ZUVuZExpc3RlbmVyKCk7XHJcbiAgICB0aGlzLnJlbW92ZUtleUxpc3RlbmVyICYmIHRoaXMucmVtb3ZlS2V5TGlzdGVuZXIoKTtcclxuICAgIHRoaXMuc2VsZWN0aW5nID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3QgaW5Sb290ID0gdGhpcy5ub2RlLmNvbnRhaW5zKGUudGFyZ2V0KTtcclxuXHJcbiAgICBjb25zdCB7IHgsIHkgfSA9IHRoaXMuZ2V0RXZlbnRDb29yZHMoZSk7XHJcbiAgICBjb25zdCBjbGljazogYm9vbGVhbiA9IHRoaXMuaXNDbGljayh4LCB5KTtcclxuXHJcbiAgICBpZiAoZS5rZXkpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZW1pdChFVkVOVF9UWVBFLlJFU0VULCB0aGlzLnNlbGVjdEV2ZW50RGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGNsaWNrICYmIGluUm9vdCkgcmV0dXJuIHRoaXMub25DbGlja0xpc3RlbmVyKGUpO1xyXG5cclxuICAgIGlmICghY2xpY2spIHJldHVybiB0aGlzLmVtaXQoRVZFTlRfVFlQRS5TRUxFQ1QsIHRoaXMuc2VsZWN0RXZlbnREYXRhKTtcclxuICB9O1xyXG5cclxuICBwcml2YXRlIG9uQ2xpY2tMaXN0ZW5lciA9IChlOiBhbnkpID0+IHtcclxuICAgIGNvbnN0IHsgeCwgeSB9ID0gdGhpcy5nZXRFdmVudENvb3JkcyhlKTtcclxuICAgIGNvbnN0IG5vdzogbnVtYmVyID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICBpZiAodGhpcy5sYXN0Q2xpY2tEYXRhICYmIG5vdyAtIHRoaXMubGFzdENsaWNrRGF0YSA8PSB0aGlzLmNsaWNrSW50ZXJ2YWwpIHtcclxuICAgICAgdGhpcy5sYXN0Q2xpY2tEYXRhID0gbnVsbDtcclxuICAgICAgcmV0dXJuIHRoaXMuZW1pdChFVkVOVF9UWVBFLkRCX0NMSUNLLCB7IHgsIHkgfSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmxhc3RDbGlja0RhdGEgPSBub3c7XHJcbiAgICByZXR1cm4gdGhpcy5lbWl0KEVWRU5UX1RZUEUuQ0xJQ0ssIHsgeCwgeSB9KTtcclxuICB9O1xyXG5cclxuICBwcml2YXRlIGdldEV2ZW50Q29vcmRzID0gKGU6IGFueSk6IEV2ZW50RGF0YSA9PiB7XHJcbiAgICBjb25zdCBjb29yZHM6IEV2ZW50RGF0YSA9IHtcclxuICAgICAgaXNUb3VjaDogZmFsc2UsXHJcbiAgICAgIHg6IGUucGFnZVgsXHJcbiAgICAgIHk6IGUucGFnZVksXHJcbiAgICB9O1xyXG4gICAgLyogaWYgKGUudG91Y2hlcyAmJiBlLnRvdWNoZXMubGVuZ3RoKSB7XHJcbiAgICAgIGNvb3Jkcy5pc1RvdWNoID0gdHJ1ZTtcclxuICAgICAgY29vcmRzLnggPSBlLnRvdWNoZXNbMF0ucGFnZVg7XHJcbiAgICAgIGNvb3Jkcy55ID0gZS50b3VjaGVzWzBdLnBhZ2VZO1xyXG4gICAgfSAqL1xyXG5cclxuICAgIC8qIHRyeSBuZXcgd2F5ID0pKSAqL1xyXG4gICAgZS50b3VjaGVzICYmXHJcbiAgICAgIGUudG91Y2hlcy5sZW5ndGggJiZcclxuICAgICAgKChjb29yZHMuaXNUb3VjaCA9IHRydWUpLCAoY29vcmRzLnggPSBlLnRvdWNoZXNbMF0ucGFnZVgpLCAoY29vcmRzLnkgPSBlLnRvdWNoZXNbMF0ucGFnZVkpKTtcclxuICAgIHJldHVybiBjb29yZHM7XHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBpc0NsaWNrID0gKGN1cnJYOiBudW1iZXIsIGN1cnJZOiBudW1iZXIpOiBib29sZWFuID0+IHtcclxuICAgIGNvbnN0IHsgaXNUb3VjaCwgeCwgeSB9ID0gdGhpcy5pbml0aWFsRXZlbnREYXRhO1xyXG4gICAgcmV0dXJuICFpc1RvdWNoICYmIE1hdGguYWJzKGN1cnJYIC0geCkgPD0gdGhpcy5jbGlja1RvbGVyYW5jZSAmJiBNYXRoLmFicyhjdXJyWSAtIHkpIDw9IHRoaXMuY2xpY2tUb2xlcmFuY2U7XHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSB0b3VjaEVkZ2VzID0gKHg6IG51bWJlciwgeTogbnVtYmVyKTogeyB0b3VjaDogYm9vbGVhbjsgZGlyOiBzdHJpbmcgfCBudWxsIH0gPT4ge1xyXG4gICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSB0aGlzLmdldEJvdW5kaW5nUmVjdCh0aGlzLm5vZGUpO1xyXG5cclxuICAgIGxldCBhZnRlclg6IG51bWJlciA9IHg7XHJcbiAgICBsZXQgYWZ0ZXJZOiBudW1iZXIgPSB5O1xyXG5cclxuICAgIGlmICh0aGlzLnNhdmVNb3VzZUNvb3Jkcykge1xyXG4gICAgICBhZnRlclggPSB4IC0gdGhpcy5vcmlnRGlzdGFuY2VGcm9tWFRvTm9kZTtcclxuICAgICAgYWZ0ZXJZID0geSAtIHRoaXMub3JpZ0Rpc3RhbmNlRnJvbVlUb05vZGU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGFmdGVyWCA8IDApIHtcclxuICAgICAgcmV0dXJuIHsgdG91Y2g6IHRydWUsIGRpcjogRElSRUNUSU9OLkxFRlQgfTtcclxuICAgIH1cclxuICAgIGlmIChhZnRlclggKyB3aWR0aCA+IHRoaXMuY3VycmVudFdpbmRvd1dpZHRoKSB7XHJcbiAgICAgIHJldHVybiB7IHRvdWNoOiB0cnVlLCBkaXI6IERJUkVDVElPTi5SSUdIVCB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGFmdGVyWSA8IDApIHtcclxuICAgICAgcmV0dXJuIHsgdG91Y2g6IHRydWUsIGRpcjogRElSRUNUSU9OLlRPUCB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGFmdGVyWSArIGhlaWdodCA+IHRoaXMuY3VycmVudFdpbmRvd0hlaWdodCkge1xyXG4gICAgICByZXR1cm4geyB0b3VjaDogdHJ1ZSwgZGlyOiBESVJFQ1RJT04uQk9UVE9NIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4geyB0b3VjaDogZmFsc2UsIGRpcjogbnVsbCB9O1xyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgY2FsY0dyaWRNb3ZlbWVudCA9IChjdXJyUG9zaXRpb246IG51bWJlcikgPT4ge1xyXG4gICAgcmV0dXJuIE1hdGguZmxvb3IoY3VyclBvc2l0aW9uIC8gdGhpcy5ncmlkTW92ZW1lbnQpICogdGhpcy5ncmlkTW92ZW1lbnQ7XHJcbiAgfTtcclxuICAvKiBoYW5kbGluZyBldmVudCAqL1xyXG5cclxuICAvKiBET00gbWFuaXB1bGF0aW9uICovXHJcbiAgcHJpdmF0ZSBvbkNyZWF0ZUdob3N0RWwgPSAobm9kZTogRWxlbWVudCkgPT4ge1xyXG4gICAgLy8gY3JlYXRlIGdob3N0IGVsXHJcbiAgICBpZiAodGhpcy5naG9zdCAmJiB0aGlzLmdob3N0LmVuYWJsZSkge1xyXG4gICAgICBjb25zdCBnaG9zdDogTm9kZSA9IG5vZGUuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgICAoZ2hvc3QgYXMgSFRNTEVsZW1lbnQpLmlkID0gXCJwZS1naG9zdFwiO1xyXG4gICAgICBpZiAodGhpcy5naG9zdC5zdHlsZSkge1xyXG4gICAgICAgIGZvciAobGV0IHMgaW4gdGhpcy5naG9zdC5zdHlsZSkge1xyXG4gICAgICAgICAgaWYgKHRoaXMuZ2hvc3Quc3R5bGVbc10pIHtcclxuICAgICAgICAgICAgKGdob3N0IGFzIEhUTUxFbGVtZW50KS5zdHlsZVtzXSA9IHRoaXMuZ2hvc3Quc3R5bGVbc107XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuZW1pdChFVkVOVF9UWVBFLkJFRk9SRV9DUkVBVEVfR0hPU1QsIGdob3N0KTtcclxuICAgICAgdGhpcy5ib2R5RWwuaW5zZXJ0QmVmb3JlKGdob3N0LCBub2RlKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBwcml2YXRlIG9uRGVsR2hvc3RFbCA9ICgpID0+IHRoaXMuZ2hvc3QgJiYgdGhpcy5naG9zdC5lbmFibGUgJiYgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwZS1naG9zdFwiKS5yZW1vdmUoKTtcclxuICAvKiBET00gbWFuaXB1bGF0aW9uICovXHJcblxyXG4gIC8qIEluc3BpcmUgYnkgRXZlbnRFbWlpdGVyLCB0dXJuc291dCBpdCdzIFB1YlN1YiBwYXR0ZXJuICovXHJcbiAgb24gPSAodHlwZTogc3RyaW5nLCBoYW5kbGVyOiBGdW5jdGlvbik6IHsgb2ZmOiBGdW5jdGlvbiB9ID0+IHtcclxuICAgIGxldCBpZHg6IG51bWJlciA9ICh0aGlzLmxpc3RlbmVyc1t0eXBlXSB8fCAodGhpcy5saXN0ZW5lcnNbdHlwZV0gPSBbXSkpLnB1c2goaGFuZGxlcikgLSAxO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgb2ZmKCkge1xyXG4gICAgICAgIHRoaXMubGlzdGVuZXJzW3R5cGVdLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9O1xyXG5cclxuICBwcml2YXRlIGVtaXQgPSAodHlwZTogc3RyaW5nLCAuLi5hcmdzOiBhbnkpOiB2b2lkID0+IHtcclxuICAgICh0aGlzLmxpc3RlbmVyc1t0eXBlXSB8fCBbXSkuZm9yRWFjaCgoZm4pID0+IHtcclxuICAgICAgZm4oLi4uYXJncyk7XHJcbiAgICB9KTtcclxuICB9O1xyXG4gIC8qIEluc3BpcmUgYnkgRXZlbnRFbWlpdGVyLCB0dXJuc291dCBpdCdzIFB1YlN1YiBwYXR0ZXJuICovXHJcbn1cclxuZXhwb3J0IGRlZmF1bHQgUG9pbnRFbWl0dGVyO1xyXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNkJBO0FBZ0NBO0FBQUE7QUFFQTtBQWpDQTtBQUNBO0FBRUE7QUFHQTtBQThDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBU0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXhVQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUEwQkE7QUFEQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFDQTs7O0FBQUE7QUEyUkE7QUFBQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///0\n')}]).default}));