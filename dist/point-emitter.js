!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PointEmitter=t():n.PointEmitter=t()}(this,(function(){return function(n){var t={};function e(c){if(t[c])return t[c].exports;var l=t[c]={i:c,l:!1,exports:{}};return n[c].call(l.exports,l,l.exports,e),l.l=!0,l.exports}return e.m=n,e.c=t,e.d=function(n,t,c){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:c})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var c=Object.create(null);if(e.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var l in n)e.d(c,l,function(t){return n[t]}.bind(null,l));return c},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=0)}([function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\nvar __assign = (undefined && undefined.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar EVENT_TYPE;\r\n(function (EVENT_TYPE) {\r\n    EVENT_TYPE["BEFORE_SELECT"] = "BEFORE_SELECT";\r\n    EVENT_TYPE["SELECT_START"] = "SELECT_START";\r\n    EVENT_TYPE["SELECTING"] = "SELECTING";\r\n    EVENT_TYPE["SELECT"] = "SELECT";\r\n    EVENT_TYPE["CLICK"] = "CLICK";\r\n    EVENT_TYPE["DB_CLICK"] = "DB_CLICK";\r\n    EVENT_TYPE["TOUCH_EDGES"] = "TOUCH_EDGES";\r\n    EVENT_TYPE["RESET"] = "RESET";\r\n})(EVENT_TYPE || (EVENT_TYPE = {}));\r\nvar DIRECTION;\r\n(function (DIRECTION) {\r\n    DIRECTION["TOP"] = "TOP";\r\n    DIRECTION["RIGHT"] = "RIGHT";\r\n    DIRECTION["BOTTOM"] = "BOTTOM";\r\n    DIRECTION["LEFT"] = "LEFT";\r\n})(DIRECTION || (DIRECTION = {}));\r\nvar PointEmitter = /** @class */ (function () {\r\n    function PointEmitter(node, _a) {\r\n        var _this = this;\r\n        var _b = _a === void 0 ? {} : _a, _c = _b.longPressThreshold, longPressThreshold = _c === void 0 ? 250 : _c, _d = _b.gridMovement, gridMovement = _d === void 0 ? 0 : _d;\r\n        this.clickTolerance = 5;\r\n        this.clickInterval = 250;\r\n        this.currentWindowWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\r\n        this.currentWindowHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\r\n        this.destroy = function () {\r\n            _this.node = null;\r\n            _this.listeners = Object.create(null);\r\n            _this.initialEventData = null;\r\n            _this.origDistanceFromXToNode = null;\r\n            _this.origDistanceFromYToNode = null;\r\n            _this.selecting = false;\r\n            _this.selectEventData = null;\r\n            _this.lastClickData = null;\r\n            _this.removeInitialEventListener && _this.removeInitialEventListener();\r\n            _this.removeMoveListener && _this.removeMoveListener();\r\n            _this.removeEndListener && _this.removeEndListener();\r\n            _this.removeKeyListener && _this.removeKeyListener();\r\n            _this.removeTouchMoveWindowListener && _this.removeTouchMoveWindowListener();\r\n        };\r\n        /* getter setter */\r\n        /* wrapper for add event listener */\r\n        this.listener = function (type, handler, target) {\r\n            target && target.addEventListener(type, handler, { passive: false });\r\n            !target && _this.node.addEventListener(type, handler, { passive: false });\r\n            return function () {\r\n                target && target.removeEventListener(type, handler, { passive: false });\r\n                !target && _this.node.removeEventListener(type, handler);\r\n            };\r\n        };\r\n        /* wrapper for add event listener */\r\n        /*  */\r\n        this.getBoundingRect = function (node) {\r\n            if (!node)\r\n                return;\r\n            var nodeBox = node.getBoundingClientRect();\r\n            return {\r\n                top: nodeBox.top,\r\n                left: nodeBox.left,\r\n                width: nodeBox.width,\r\n                height: nodeBox.height,\r\n            };\r\n        };\r\n        /*  */\r\n        /* Listen for mousedown & touchstart. When one is received, disabled the other and setup future event base on type */\r\n        this.onInitialEventListener = function () {\r\n            if (!_this.node)\r\n                return;\r\n            var removeTouchStartListener = _this.listener("touchstart", function (e) {\r\n                _this.removeInitialEventListener();\r\n                _this.removeInitialEventListener = _this.onAddLongPressListener(_this.onHandleEventListener, e);\r\n            });\r\n            var removeMouseDownListener = _this.listener("mousedown", function (e) {\r\n                _this.removeInitialEventListener();\r\n                _this.onHandleEventListener(e);\r\n                _this.removeInitialEventListener = _this.listener("mousedown", _this.onHandleEventListener);\r\n            });\r\n            _this.removeInitialEventListener = function () {\r\n                removeTouchStartListener();\r\n                removeMouseDownListener();\r\n            };\r\n        };\r\n        /* Listen for mousedown & touchstart. When one is received, disabled the other and setup future event base on type */\r\n        /* handling event */\r\n        this.onHandleEventListener = function (e) {\r\n            var _a = _this.getEventCoords(e), isTouch = _a.isTouch, x = _a.x, y = _a.y;\r\n            var _b = _this.getBoundingRect(_this.node), top = _b.top, left = _b.left;\r\n            _this.origDistanceFromYToNode = y - top;\r\n            _this.origDistanceFromXToNode = x - left;\r\n            _this.selectEventData = { x: x, y: y };\r\n            _this.initialEventData = { isTouch: isTouch, x: x, y: y };\r\n            _this.emit(EVENT_TYPE.BEFORE_SELECT, _this.initialEventData);\r\n            switch (e.type) {\r\n                case "touchstart":\r\n                    _this.removeMoveListener = _this.listener("touchmove", _this.onMoveListener);\r\n                    _this.removeEndListener = _this.listener("touchend", _this.onEndListener);\r\n                    _this.removeKeyListener = _this.listener("keydown", _this.onEndListener, window);\r\n                    break;\r\n                case "mousedown":\r\n                    _this.removeMoveListener = _this.listener("mousemove", _this.onMoveListener);\r\n                    _this.removeEndListener = _this.listener("mouseup", _this.onEndListener);\r\n                    _this.removeKeyListener = _this.listener("keydown", _this.onEndListener, window);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        };\r\n        /* add long press listener if user touch the screen without moving their finger for 250ms */\r\n        this.onAddLongPressListener = function (handleEventListener, e) {\r\n            var longPressTimer = null;\r\n            var removeTouchMoveListener = null;\r\n            var removeToucEndListener = null;\r\n            var cleanup = function () {\r\n                longPressTimer && clearTimeout(longPressTimer);\r\n                removeTouchMoveListener && removeTouchMoveListener();\r\n                removeToucEndListener && removeToucEndListener();\r\n                longPressTimer = null;\r\n                removeTouchMoveListener = null;\r\n                removeToucEndListener = null;\r\n            };\r\n            var onTouchStart = function (e) {\r\n                longPressTimer = setTimeout(function () {\r\n                    cleanup();\r\n                    handleEventListener(e);\r\n                }, _this.longPressThreshold);\r\n                removeTouchMoveListener = _this.listener("touchmove", function () { return cleanup(); });\r\n                removeToucEndListener = _this.listener("touchend", function () { return cleanup(); });\r\n            };\r\n            var removeTouchStartListener = _this.listener("touchstart", onTouchStart);\r\n            e && onTouchStart(e);\r\n            return function () {\r\n                cleanup();\r\n                removeTouchStartListener();\r\n            };\r\n        };\r\n        this.onMoveListener = function (e) {\r\n            if (!_this.initialEventData)\r\n                return;\r\n            var _a = _this.initialEventData, initX = _a.x, initY = _a.y;\r\n            var _b = _this.getEventCoords(e), x = _b.x, y = _b.y;\r\n            var origSelecting = _this.selecting, distanceFromInitXToX = Math.abs(initX - x), distanceFromInitYToY = Math.abs(initY - y), click = _this.isClick(x, y);\r\n            // Prevent emitting selectStart event until mouse is moved.\r\n            // in Chrome on Windows, mouseMove event may be fired just after mouseDown event.\r\n            if (_this.isClick(x, y) && !origSelecting && !(distanceFromInitXToX || distanceFromInitYToY))\r\n                return;\r\n            var afterX = x - _this.origDistanceFromXToNode;\r\n            var afterY = y - _this.origDistanceFromYToNode;\r\n            if (_this.gridMovement) {\r\n                afterX = _this.calcGridMovement(afterX);\r\n                afterY = _this.calcGridMovement(afterY);\r\n            }\r\n            _this.selectEventData = { x: afterX, y: afterY };\r\n            _this.selecting = true;\r\n            !origSelecting && _this.emit(EVENT_TYPE.SELECT_START, { x: initX, y: initY });\r\n            !click && _this.emit(EVENT_TYPE.SELECTING, _this.selectEventData);\r\n            var _c = _this.touchEdges(x, y), touch = _c.touch, dir = _c.dir;\r\n            if (touch) {\r\n                return _this.emit(EVENT_TYPE.TOUCH_EDGES, __assign(__assign({}, _this.selectEventData), { dir: dir }));\r\n            }\r\n            e.preventDefault();\r\n        };\r\n        this.onEndListener = function (e) {\r\n            if (!_this.initialEventData)\r\n                return;\r\n            _this.removeMoveListener && _this.removeMoveListener();\r\n            _this.removeEndListener && _this.removeEndListener();\r\n            _this.removeKeyListener && _this.removeKeyListener();\r\n            _this.selecting = false;\r\n            var inRoot = _this.node.contains(e.target);\r\n            var _a = _this.getEventCoords(e), x = _a.x, y = _a.y;\r\n            var click = _this.isClick(x, y);\r\n            if (e.key) {\r\n                return _this.emit(EVENT_TYPE.RESET, _this.selectEventData);\r\n            }\r\n            if (click && inRoot)\r\n                return _this.onClickListener(e);\r\n            if (!click)\r\n                return _this.emit(EVENT_TYPE.SELECT, _this.selectEventData);\r\n        };\r\n        this.onClickListener = function (e) {\r\n            var _a = _this.getEventCoords(e), x = _a.x, y = _a.y;\r\n            var now = new Date().getTime();\r\n            if (_this.lastClickData && now - _this.lastClickData <= _this.clickInterval) {\r\n                _this.lastClickData = null;\r\n                return _this.emit(EVENT_TYPE.DB_CLICK, { x: x, y: y });\r\n            }\r\n            _this.lastClickData = now;\r\n            return _this.emit(EVENT_TYPE.CLICK, { x: x, y: y });\r\n        };\r\n        this.getEventCoords = function (e) {\r\n            var coords = {\r\n                isTouch: false,\r\n                x: e.pageX,\r\n                y: e.pageY,\r\n            };\r\n            /* if (e.touches && e.touches.length) {\r\n              coords.isTouch = true;\r\n              coords.x = e.touches[0].pageX;\r\n              coords.y = e.touches[0].pageY;\r\n            } */\r\n            /* try new way =)) */\r\n            e.touches &&\r\n                e.touches.length &&\r\n                ((coords.isTouch = true), (coords.x = e.touches[0].pageX), (coords.y = e.touches[0].pageY));\r\n            return coords;\r\n        };\r\n        this.isClick = function (currX, currY) {\r\n            var _a = _this.initialEventData, isTouch = _a.isTouch, x = _a.x, y = _a.y;\r\n            return !isTouch && Math.abs(currX - x) <= _this.clickTolerance && Math.abs(currY - y) <= _this.clickTolerance;\r\n        };\r\n        this.touchEdges = function (x, y) {\r\n            var _a = _this.getBoundingRect(_this.node), width = _a.width, height = _a.height;\r\n            var afterX = x - _this.origDistanceFromXToNode;\r\n            var afterY = y - _this.origDistanceFromYToNode;\r\n            if (afterX < 0) {\r\n                return { touch: true, dir: DIRECTION.LEFT };\r\n            }\r\n            if (afterX + width > _this.currentWindowWidth) {\r\n                return { touch: true, dir: DIRECTION.RIGHT };\r\n            }\r\n            if (afterY < 0) {\r\n                return { touch: true, dir: DIRECTION.TOP };\r\n            }\r\n            if (afterY + height > _this.currentWindowHeight) {\r\n                return { touch: true, dir: DIRECTION.BOTTOM };\r\n            }\r\n            return { touch: false, dir: null };\r\n        };\r\n        this.calcGridMovement = function (currPosition) {\r\n            return Math.floor(currPosition / _this.gridMovement) * _this.gridMovement;\r\n        };\r\n        /* handling event */\r\n        /* Inspire by EventEmiiter, turnsout it\'s PubSub pattern */\r\n        this.on = function (type, handler) {\r\n            var idx = (_this.listeners[type] || (_this.listeners[type] = [])).push(handler) - 1;\r\n            return {\r\n                off: function () {\r\n                    this.listeners[type].splice(idx, 1);\r\n                },\r\n            };\r\n        };\r\n        this.emit = function (type) {\r\n            var args = [];\r\n            for (var _i = 1; _i < arguments.length; _i++) {\r\n                args[_i - 1] = arguments[_i];\r\n            }\r\n            (_this.listeners[type] || []).forEach(function (fn) {\r\n                fn.apply(void 0, args);\r\n            });\r\n        };\r\n        this.node = node;\r\n        this.listeners = Object.create(null);\r\n        this.selecting = false;\r\n        this.longPressThreshold = longPressThreshold;\r\n        this.gridMovement = gridMovement;\r\n        // Fixes an iOS 10 bug where scrolling could not be prevented on the window.\r\n        this.removeTouchMoveWindowListener = this.listener("touchmove", function () { }, window);\r\n        this.onInitialEventListener();\r\n    }\r\n    Object.defineProperty(PointEmitter.prototype, "getNode", {\r\n        /* getter setter */\r\n        get: function () {\r\n            return this.node;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(PointEmitter.prototype, "getListeners", {\r\n        get: function () {\r\n            return this.listeners;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return PointEmitter;\r\n}());\r\n/* harmony default export */ __webpack_exports__["default"] = (PointEmitter);\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1BvaW50RW1pdHRlci8uL3NyYy9pbmRleC50cz9mZmI0Il0sInNvdXJjZXNDb250ZW50IjpbImVudW0gRVZFTlRfVFlQRSB7XHJcbiAgQkVGT1JFX1NFTEVDVCA9IFwiQkVGT1JFX1NFTEVDVFwiLFxyXG4gIFNFTEVDVF9TVEFSVCA9IFwiU0VMRUNUX1NUQVJUXCIsXHJcbiAgU0VMRUNUSU5HID0gXCJTRUxFQ1RJTkdcIixcclxuICBTRUxFQ1QgPSBcIlNFTEVDVFwiLFxyXG4gIENMSUNLID0gXCJDTElDS1wiLFxyXG4gIERCX0NMSUNLID0gXCJEQl9DTElDS1wiLFxyXG4gIFRPVUNIX0VER0VTID0gXCJUT1VDSF9FREdFU1wiLFxyXG4gIFJFU0VUID0gXCJSRVNFVFwiLFxyXG59XHJcblxyXG5lbnVtIERJUkVDVElPTiB7XHJcbiAgVE9QID0gXCJUT1BcIixcclxuICBSSUdIVCA9IFwiUklHSFRcIixcclxuICBCT1RUT00gPSBcIkJPVFRPTVwiLFxyXG4gIExFRlQgPSBcIkxFRlRcIixcclxufVxyXG5cclxudHlwZSBQb2ludERhdGEgPSB7XHJcbiAgeDogbnVtYmVyO1xyXG4gIHk6IG51bWJlcjtcclxufTtcclxuXHJcbnR5cGUgRWRnZURhdGEgPSBQb2ludERhdGEgJiB7XHJcbiAgZGlyOiBESVJFQ1RJT047XHJcbn07XHJcblxyXG50eXBlIEV2ZW50RGF0YSA9IFBvaW50RGF0YSAmIHtcclxuICBpc1RvdWNoOiBib29sZWFuO1xyXG59O1xyXG5cclxudHlwZSBCb3hEYXRhID0ge1xyXG4gIHRvcDogbnVtYmVyO1xyXG4gIGxlZnQ6IG51bWJlcjtcclxuICB3aWR0aDogbnVtYmVyO1xyXG4gIGhlaWdodDogbnVtYmVyO1xyXG59O1xyXG5cclxudHlwZSBMaXN0ZW5lckRhdGEgPSB7IFtrZXk6IHN0cmluZ106IEZ1bmN0aW9uW10gfTtcclxuXHJcbmNsYXNzIFBvaW50RW1pdHRlciB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBjbGlja1RvbGVyYW5jZTogbnVtYmVyID0gNTtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNsaWNrSW50ZXJ2YWw6IG51bWJlciA9IDI1MDtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBjdXJyZW50V2luZG93V2lkdGg6IG51bWJlciA9XHJcbiAgICB3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHwgZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBjdXJyZW50V2luZG93SGVpZ2h0OiBudW1iZXIgPVxyXG4gICAgd2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgfHwgZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQ7XHJcblxyXG4gIHByaXZhdGUgbG9uZ1ByZXNzVGhyZXNob2xkOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBncmlkTW92ZW1lbnQ6IG51bWJlcjtcclxuXHJcbiAgcHJpdmF0ZSBub2RlOiBFbGVtZW50IHwgbnVsbDtcclxuICBwcml2YXRlIGxpc3RlbmVyczogTGlzdGVuZXJEYXRhO1xyXG4gIHByaXZhdGUgaW5pdGlhbEV2ZW50RGF0YTogRXZlbnREYXRhIHwgbnVsbDtcclxuICBwcml2YXRlIG9yaWdEaXN0YW5jZUZyb21YVG9Ob2RlOiBudW1iZXIgfCBudWxsO1xyXG4gIHByaXZhdGUgb3JpZ0Rpc3RhbmNlRnJvbVlUb05vZGU6IG51bWJlciB8IG51bGw7XHJcbiAgcHJpdmF0ZSBzZWxlY3Rpbmc6IGJvb2xlYW47XHJcbiAgcHJpdmF0ZSBzZWxlY3RFdmVudERhdGE6IFBvaW50RGF0YSB8IG51bGw7IC8vIHNhdmUgY3VyclggJiBjdXJyWSBmb3IgU0VMRUNUSU5HICYgU0VMRUNUIHR5cGUgY2F1c2UgXCJ0b3VjaEVuZFwiIGRvZXNuJ3QgaGF2ZSBcInBhZ2VYLCBwYWdlWVwiXHJcbiAgcHJpdmF0ZSBsYXN0Q2xpY2tEYXRhOiBudW1iZXIgfCBudWxsOyAvLyBzYXZlIGxhc3QgY2xpY2sgdG8gY29tcGFyZSB3aXRoIGxhdGVzdCBjbGljayBmb3IgREJfQ0xJQ0sgdHlwZVxyXG5cclxuICBwcml2YXRlIHJlbW92ZUluaXRpYWxFdmVudExpc3RlbmVyOiBGdW5jdGlvbjtcclxuICBwcml2YXRlIHJlbW92ZU1vdmVMaXN0ZW5lcjogRnVuY3Rpb247XHJcbiAgcHJpdmF0ZSByZW1vdmVFbmRMaXN0ZW5lcjogRnVuY3Rpb247XHJcbiAgcHJpdmF0ZSByZW1vdmVLZXlMaXN0ZW5lcjogRnVuY3Rpb247XHJcbiAgcHJpdmF0ZSByZW1vdmVUb3VjaE1vdmVXaW5kb3dMaXN0ZW5lcjogRnVuY3Rpb247XHJcblxyXG4gIGNvbnN0cnVjdG9yKG5vZGU6IEVsZW1lbnQgfCBudWxsLCB7IGxvbmdQcmVzc1RocmVzaG9sZCA9IDI1MCwgZ3JpZE1vdmVtZW50ID0gMCB9ID0ge30pIHtcclxuICAgIHRoaXMubm9kZSA9IG5vZGU7XHJcbiAgICB0aGlzLmxpc3RlbmVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICB0aGlzLnNlbGVjdGluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5sb25nUHJlc3NUaHJlc2hvbGQgPSBsb25nUHJlc3NUaHJlc2hvbGQ7XHJcbiAgICB0aGlzLmdyaWRNb3ZlbWVudCA9IGdyaWRNb3ZlbWVudDtcclxuXHJcbiAgICAvLyBGaXhlcyBhbiBpT1MgMTAgYnVnIHdoZXJlIHNjcm9sbGluZyBjb3VsZCBub3QgYmUgcHJldmVudGVkIG9uIHRoZSB3aW5kb3cuXHJcbiAgICB0aGlzLnJlbW92ZVRvdWNoTW92ZVdpbmRvd0xpc3RlbmVyID0gdGhpcy5saXN0ZW5lcihcInRvdWNobW92ZVwiLCAoKSA9PiB7fSwgd2luZG93KTtcclxuXHJcbiAgICB0aGlzLm9uSW5pdGlhbEV2ZW50TGlzdGVuZXIoKTtcclxuICB9XHJcblxyXG4gIGRlc3Ryb3kgPSAoKSA9PiB7XHJcbiAgICB0aGlzLm5vZGUgPSBudWxsO1xyXG4gICAgdGhpcy5saXN0ZW5lcnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgdGhpcy5pbml0aWFsRXZlbnREYXRhID0gbnVsbDtcclxuICAgIHRoaXMub3JpZ0Rpc3RhbmNlRnJvbVhUb05vZGUgPSBudWxsO1xyXG4gICAgdGhpcy5vcmlnRGlzdGFuY2VGcm9tWVRvTm9kZSA9IG51bGw7XHJcbiAgICB0aGlzLnNlbGVjdGluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5zZWxlY3RFdmVudERhdGEgPSBudWxsO1xyXG4gICAgdGhpcy5sYXN0Q2xpY2tEYXRhID0gbnVsbDtcclxuXHJcbiAgICB0aGlzLnJlbW92ZUluaXRpYWxFdmVudExpc3RlbmVyICYmIHRoaXMucmVtb3ZlSW5pdGlhbEV2ZW50TGlzdGVuZXIoKTtcclxuICAgIHRoaXMucmVtb3ZlTW92ZUxpc3RlbmVyICYmIHRoaXMucmVtb3ZlTW92ZUxpc3RlbmVyKCk7XHJcbiAgICB0aGlzLnJlbW92ZUVuZExpc3RlbmVyICYmIHRoaXMucmVtb3ZlRW5kTGlzdGVuZXIoKTtcclxuICAgIHRoaXMucmVtb3ZlS2V5TGlzdGVuZXIgJiYgdGhpcy5yZW1vdmVLZXlMaXN0ZW5lcigpO1xyXG4gICAgdGhpcy5yZW1vdmVUb3VjaE1vdmVXaW5kb3dMaXN0ZW5lciAmJiB0aGlzLnJlbW92ZVRvdWNoTW92ZVdpbmRvd0xpc3RlbmVyKCk7XHJcbiAgfTtcclxuICAvKiBnZXR0ZXIgc2V0dGVyICovXHJcbiAgZ2V0IGdldE5vZGUoKTogRWxlbWVudCB7XHJcbiAgICByZXR1cm4gdGhpcy5ub2RlO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGdldExpc3RlbmVycygpOiBMaXN0ZW5lckRhdGEge1xyXG4gICAgcmV0dXJuIHRoaXMubGlzdGVuZXJzO1xyXG4gIH1cclxuICAvKiBnZXR0ZXIgc2V0dGVyICovXHJcblxyXG4gIC8qIHdyYXBwZXIgZm9yIGFkZCBldmVudCBsaXN0ZW5lciAqL1xyXG4gIGxpc3RlbmVyID0gKHR5cGU6IHN0cmluZywgaGFuZGxlcjogRXZlbnRMaXN0ZW5lck9yRXZlbnRMaXN0ZW5lck9iamVjdCwgdGFyZ2V0PzogYW55KSA9PiB7XHJcbiAgICB0YXJnZXQgJiYgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlciwgeyBwYXNzaXZlOiBmYWxzZSB9KTtcclxuICAgICF0YXJnZXQgJiYgdGhpcy5ub2RlLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlciwgeyBwYXNzaXZlOiBmYWxzZSB9KTtcclxuXHJcbiAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICB0YXJnZXQgJiYgdGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlciwgeyBwYXNzaXZlOiBmYWxzZSB9KTtcclxuICAgICAgIXRhcmdldCAmJiB0aGlzLm5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBoYW5kbGVyKTtcclxuICAgIH07XHJcbiAgfTtcclxuICAvKiB3cmFwcGVyIGZvciBhZGQgZXZlbnQgbGlzdGVuZXIgKi9cclxuXHJcbiAgLyogICovXHJcbiAgZ2V0Qm91bmRpbmdSZWN0ID0gKG5vZGU6IEVsZW1lbnQpOiBCb3hEYXRhID0+IHtcclxuICAgIGlmICghbm9kZSkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IG5vZGVCb3g6IERPTVJlY3QgPSBub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdG9wOiBub2RlQm94LnRvcCxcclxuICAgICAgbGVmdDogbm9kZUJveC5sZWZ0LFxyXG4gICAgICB3aWR0aDogbm9kZUJveC53aWR0aCxcclxuICAgICAgaGVpZ2h0OiBub2RlQm94LmhlaWdodCxcclxuICAgIH07XHJcbiAgfTtcclxuICAvKiAgKi9cclxuXHJcbiAgLyogTGlzdGVuIGZvciBtb3VzZWRvd24gJiB0b3VjaHN0YXJ0LiBXaGVuIG9uZSBpcyByZWNlaXZlZCwgZGlzYWJsZWQgdGhlIG90aGVyIGFuZCBzZXR1cCBmdXR1cmUgZXZlbnQgYmFzZSBvbiB0eXBlICovXHJcbiAgb25Jbml0aWFsRXZlbnRMaXN0ZW5lciA9ICgpOiB2b2lkID0+IHtcclxuICAgIGlmICghdGhpcy5ub2RlKSByZXR1cm47XHJcblxyXG4gICAgY29uc3QgcmVtb3ZlVG91Y2hTdGFydExpc3RlbmVyID0gdGhpcy5saXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgKGUpID0+IHtcclxuICAgICAgdGhpcy5yZW1vdmVJbml0aWFsRXZlbnRMaXN0ZW5lcigpO1xyXG4gICAgICB0aGlzLnJlbW92ZUluaXRpYWxFdmVudExpc3RlbmVyID0gdGhpcy5vbkFkZExvbmdQcmVzc0xpc3RlbmVyKHRoaXMub25IYW5kbGVFdmVudExpc3RlbmVyLCBlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHJlbW92ZU1vdXNlRG93bkxpc3RlbmVyID0gdGhpcy5saXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xyXG4gICAgICB0aGlzLnJlbW92ZUluaXRpYWxFdmVudExpc3RlbmVyKCk7XHJcbiAgICAgIHRoaXMub25IYW5kbGVFdmVudExpc3RlbmVyKGUpO1xyXG4gICAgICB0aGlzLnJlbW92ZUluaXRpYWxFdmVudExpc3RlbmVyID0gdGhpcy5saXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLm9uSGFuZGxlRXZlbnRMaXN0ZW5lcik7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLnJlbW92ZUluaXRpYWxFdmVudExpc3RlbmVyID0gKCkgPT4ge1xyXG4gICAgICByZW1vdmVUb3VjaFN0YXJ0TGlzdGVuZXIoKTtcclxuICAgICAgcmVtb3ZlTW91c2VEb3duTGlzdGVuZXIoKTtcclxuICAgIH07XHJcbiAgfTtcclxuICAvKiBMaXN0ZW4gZm9yIG1vdXNlZG93biAmIHRvdWNoc3RhcnQuIFdoZW4gb25lIGlzIHJlY2VpdmVkLCBkaXNhYmxlZCB0aGUgb3RoZXIgYW5kIHNldHVwIGZ1dHVyZSBldmVudCBiYXNlIG9uIHR5cGUgKi9cclxuXHJcbiAgLyogaGFuZGxpbmcgZXZlbnQgKi9cclxuICBvbkhhbmRsZUV2ZW50TGlzdGVuZXIgPSAoZTogYW55KSA9PiB7XHJcbiAgICBjb25zdCB7IGlzVG91Y2gsIHgsIHkgfSA9IHRoaXMuZ2V0RXZlbnRDb29yZHMoZSk7XHJcbiAgICBjb25zdCB7IHRvcCwgbGVmdCB9ID0gdGhpcy5nZXRCb3VuZGluZ1JlY3QodGhpcy5ub2RlKTtcclxuICAgIHRoaXMub3JpZ0Rpc3RhbmNlRnJvbVlUb05vZGUgPSB5IC0gdG9wO1xyXG4gICAgdGhpcy5vcmlnRGlzdGFuY2VGcm9tWFRvTm9kZSA9IHggLSBsZWZ0O1xyXG4gICAgdGhpcy5zZWxlY3RFdmVudERhdGEgPSB7IHgsIHkgfTtcclxuICAgIHRoaXMuaW5pdGlhbEV2ZW50RGF0YSA9IHsgaXNUb3VjaCwgeCwgeSB9O1xyXG4gICAgdGhpcy5lbWl0KEVWRU5UX1RZUEUuQkVGT1JFX1NFTEVDVCwgdGhpcy5pbml0aWFsRXZlbnREYXRhKTtcclxuXHJcbiAgICBzd2l0Y2ggKGUudHlwZSkge1xyXG4gICAgICBjYXNlIFwidG91Y2hzdGFydFwiOlxyXG4gICAgICAgIHRoaXMucmVtb3ZlTW92ZUxpc3RlbmVyID0gdGhpcy5saXN0ZW5lcihcInRvdWNobW92ZVwiLCB0aGlzLm9uTW92ZUxpc3RlbmVyKTtcclxuICAgICAgICB0aGlzLnJlbW92ZUVuZExpc3RlbmVyID0gdGhpcy5saXN0ZW5lcihcInRvdWNoZW5kXCIsIHRoaXMub25FbmRMaXN0ZW5lcik7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVLZXlMaXN0ZW5lciA9IHRoaXMubGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMub25FbmRMaXN0ZW5lciwgd2luZG93KTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBcIm1vdXNlZG93blwiOlxyXG4gICAgICAgIHRoaXMucmVtb3ZlTW92ZUxpc3RlbmVyID0gdGhpcy5saXN0ZW5lcihcIm1vdXNlbW92ZVwiLCB0aGlzLm9uTW92ZUxpc3RlbmVyKTtcclxuICAgICAgICB0aGlzLnJlbW92ZUVuZExpc3RlbmVyID0gdGhpcy5saXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5vbkVuZExpc3RlbmVyKTtcclxuICAgICAgICB0aGlzLnJlbW92ZUtleUxpc3RlbmVyID0gdGhpcy5saXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5vbkVuZExpc3RlbmVyLCB3aW5kb3cpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIC8qIGFkZCBsb25nIHByZXNzIGxpc3RlbmVyIGlmIHVzZXIgdG91Y2ggdGhlIHNjcmVlbiB3aXRob3V0IG1vdmluZyB0aGVpciBmaW5nZXIgZm9yIDI1MG1zICovXHJcbiAgb25BZGRMb25nUHJlc3NMaXN0ZW5lciA9IChoYW5kbGVFdmVudExpc3RlbmVyOiBGdW5jdGlvbiwgZTogYW55KSA9PiB7XHJcbiAgICBsZXQgbG9uZ1ByZXNzVGltZXI6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XHJcbiAgICBsZXQgcmVtb3ZlVG91Y2hNb3ZlTGlzdGVuZXI6IEZ1bmN0aW9uIHwgbnVsbCA9IG51bGw7XHJcbiAgICBsZXQgcmVtb3ZlVG91Y0VuZExpc3RlbmVyOiBGdW5jdGlvbiB8IG51bGwgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0IGNsZWFudXAgPSAoKSA9PiB7XHJcbiAgICAgIGxvbmdQcmVzc1RpbWVyICYmIGNsZWFyVGltZW91dChsb25nUHJlc3NUaW1lcik7XHJcbiAgICAgIHJlbW92ZVRvdWNoTW92ZUxpc3RlbmVyICYmIHJlbW92ZVRvdWNoTW92ZUxpc3RlbmVyKCk7XHJcbiAgICAgIHJlbW92ZVRvdWNFbmRMaXN0ZW5lciAmJiByZW1vdmVUb3VjRW5kTGlzdGVuZXIoKTtcclxuXHJcbiAgICAgIGxvbmdQcmVzc1RpbWVyID0gbnVsbDtcclxuICAgICAgcmVtb3ZlVG91Y2hNb3ZlTGlzdGVuZXIgPSBudWxsO1xyXG4gICAgICByZW1vdmVUb3VjRW5kTGlzdGVuZXIgPSBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBvblRvdWNoU3RhcnQgPSAoZTogYW55KSA9PiB7XHJcbiAgICAgIGxvbmdQcmVzc1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgY2xlYW51cCgpO1xyXG4gICAgICAgIGhhbmRsZUV2ZW50TGlzdGVuZXIoZSk7XHJcbiAgICAgIH0sIHRoaXMubG9uZ1ByZXNzVGhyZXNob2xkKTtcclxuICAgICAgcmVtb3ZlVG91Y2hNb3ZlTGlzdGVuZXIgPSB0aGlzLmxpc3RlbmVyKFwidG91Y2htb3ZlXCIsICgpID0+IGNsZWFudXAoKSk7XHJcbiAgICAgIHJlbW92ZVRvdWNFbmRMaXN0ZW5lciA9IHRoaXMubGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCAoKSA9PiBjbGVhbnVwKCkpO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByZW1vdmVUb3VjaFN0YXJ0TGlzdGVuZXIgPSB0aGlzLmxpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBvblRvdWNoU3RhcnQpO1xyXG5cclxuICAgIGUgJiYgb25Ub3VjaFN0YXJ0KGUpO1xyXG5cclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGNsZWFudXAoKTtcclxuICAgICAgcmVtb3ZlVG91Y2hTdGFydExpc3RlbmVyKCk7XHJcbiAgICB9O1xyXG4gIH07XHJcblxyXG4gIG9uTW92ZUxpc3RlbmVyID0gKGU6IGFueSkgPT4ge1xyXG4gICAgaWYgKCF0aGlzLmluaXRpYWxFdmVudERhdGEpIHJldHVybjtcclxuXHJcbiAgICBjb25zdCB7IHg6IGluaXRYLCB5OiBpbml0WSB9ID0gdGhpcy5pbml0aWFsRXZlbnREYXRhO1xyXG4gICAgY29uc3QgeyB4LCB5IH0gPSB0aGlzLmdldEV2ZW50Q29vcmRzKGUpO1xyXG4gICAgY29uc3Qgb3JpZ1NlbGVjdGluZzogYm9vbGVhbiA9IHRoaXMuc2VsZWN0aW5nLFxyXG4gICAgICBkaXN0YW5jZUZyb21Jbml0WFRvWDogbnVtYmVyID0gTWF0aC5hYnMoaW5pdFggLSB4KSxcclxuICAgICAgZGlzdGFuY2VGcm9tSW5pdFlUb1k6IG51bWJlciA9IE1hdGguYWJzKGluaXRZIC0geSksXHJcbiAgICAgIGNsaWNrID0gdGhpcy5pc0NsaWNrKHgsIHkpO1xyXG5cclxuICAgIC8vIFByZXZlbnQgZW1pdHRpbmcgc2VsZWN0U3RhcnQgZXZlbnQgdW50aWwgbW91c2UgaXMgbW92ZWQuXHJcbiAgICAvLyBpbiBDaHJvbWUgb24gV2luZG93cywgbW91c2VNb3ZlIGV2ZW50IG1heSBiZSBmaXJlZCBqdXN0IGFmdGVyIG1vdXNlRG93biBldmVudC5cclxuICAgIGlmICh0aGlzLmlzQ2xpY2soeCwgeSkgJiYgIW9yaWdTZWxlY3RpbmcgJiYgIShkaXN0YW5jZUZyb21Jbml0WFRvWCB8fCBkaXN0YW5jZUZyb21Jbml0WVRvWSkpIHJldHVybjtcclxuXHJcbiAgICBsZXQgYWZ0ZXJYOiBudW1iZXIgPSB4IC0gdGhpcy5vcmlnRGlzdGFuY2VGcm9tWFRvTm9kZTtcclxuICAgIGxldCBhZnRlclk6IG51bWJlciA9IHkgLSB0aGlzLm9yaWdEaXN0YW5jZUZyb21ZVG9Ob2RlO1xyXG5cclxuICAgIGlmICh0aGlzLmdyaWRNb3ZlbWVudCkge1xyXG4gICAgICBhZnRlclggPSB0aGlzLmNhbGNHcmlkTW92ZW1lbnQoYWZ0ZXJYKTtcclxuICAgICAgYWZ0ZXJZID0gdGhpcy5jYWxjR3JpZE1vdmVtZW50KGFmdGVyWSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zZWxlY3RFdmVudERhdGEgPSB7IHg6IGFmdGVyWCwgeTogYWZ0ZXJZIH07XHJcbiAgICB0aGlzLnNlbGVjdGluZyA9IHRydWU7XHJcblxyXG4gICAgIW9yaWdTZWxlY3RpbmcgJiYgdGhpcy5lbWl0KEVWRU5UX1RZUEUuU0VMRUNUX1NUQVJULCB7IHg6IGluaXRYLCB5OiBpbml0WSB9KTtcclxuICAgICFjbGljayAmJiB0aGlzLmVtaXQoRVZFTlRfVFlQRS5TRUxFQ1RJTkcsIHRoaXMuc2VsZWN0RXZlbnREYXRhKTtcclxuXHJcbiAgICBjb25zdCB7IHRvdWNoLCBkaXIgfSA9IHRoaXMudG91Y2hFZGdlcyh4LCB5KTtcclxuICAgIGlmICh0b3VjaCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5lbWl0KEVWRU5UX1RZUEUuVE9VQ0hfRURHRVMsIHsgLi4udGhpcy5zZWxlY3RFdmVudERhdGEsIGRpciB9KTtcclxuICAgIH1cclxuXHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgfTtcclxuXHJcbiAgb25FbmRMaXN0ZW5lciA9IChlOiBhbnkpID0+IHtcclxuICAgIGlmICghdGhpcy5pbml0aWFsRXZlbnREYXRhKSByZXR1cm47XHJcblxyXG4gICAgdGhpcy5yZW1vdmVNb3ZlTGlzdGVuZXIgJiYgdGhpcy5yZW1vdmVNb3ZlTGlzdGVuZXIoKTtcclxuICAgIHRoaXMucmVtb3ZlRW5kTGlzdGVuZXIgJiYgdGhpcy5yZW1vdmVFbmRMaXN0ZW5lcigpO1xyXG4gICAgdGhpcy5yZW1vdmVLZXlMaXN0ZW5lciAmJiB0aGlzLnJlbW92ZUtleUxpc3RlbmVyKCk7XHJcbiAgICB0aGlzLnNlbGVjdGluZyA9IGZhbHNlO1xyXG5cclxuICAgIGNvbnN0IGluUm9vdCA9IHRoaXMubm9kZS5jb250YWlucyhlLnRhcmdldCk7XHJcblxyXG4gICAgY29uc3QgeyB4LCB5IH0gPSB0aGlzLmdldEV2ZW50Q29vcmRzKGUpO1xyXG4gICAgY29uc3QgY2xpY2s6IGJvb2xlYW4gPSB0aGlzLmlzQ2xpY2soeCwgeSk7XHJcblxyXG4gICAgaWYgKGUua2V5KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmVtaXQoRVZFTlRfVFlQRS5SRVNFVCwgdGhpcy5zZWxlY3RFdmVudERhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChjbGljayAmJiBpblJvb3QpIHJldHVybiB0aGlzLm9uQ2xpY2tMaXN0ZW5lcihlKTtcclxuXHJcbiAgICBpZiAoIWNsaWNrKSByZXR1cm4gdGhpcy5lbWl0KEVWRU5UX1RZUEUuU0VMRUNULCB0aGlzLnNlbGVjdEV2ZW50RGF0YSk7XHJcbiAgfTtcclxuXHJcbiAgb25DbGlja0xpc3RlbmVyID0gKGU6IGFueSkgPT4ge1xyXG4gICAgY29uc3QgeyB4LCB5IH0gPSB0aGlzLmdldEV2ZW50Q29vcmRzKGUpO1xyXG4gICAgY29uc3Qgbm93OiBudW1iZXIgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgIGlmICh0aGlzLmxhc3RDbGlja0RhdGEgJiYgbm93IC0gdGhpcy5sYXN0Q2xpY2tEYXRhIDw9IHRoaXMuY2xpY2tJbnRlcnZhbCkge1xyXG4gICAgICB0aGlzLmxhc3RDbGlja0RhdGEgPSBudWxsO1xyXG4gICAgICByZXR1cm4gdGhpcy5lbWl0KEVWRU5UX1RZUEUuREJfQ0xJQ0ssIHsgeCwgeSB9KTtcclxuICAgIH1cclxuICAgIHRoaXMubGFzdENsaWNrRGF0YSA9IG5vdztcclxuICAgIHJldHVybiB0aGlzLmVtaXQoRVZFTlRfVFlQRS5DTElDSywgeyB4LCB5IH0pO1xyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgZ2V0RXZlbnRDb29yZHMgPSAoZTogYW55KTogRXZlbnREYXRhID0+IHtcclxuICAgIGNvbnN0IGNvb3JkczogRXZlbnREYXRhID0ge1xyXG4gICAgICBpc1RvdWNoOiBmYWxzZSxcclxuICAgICAgeDogZS5wYWdlWCxcclxuICAgICAgeTogZS5wYWdlWSxcclxuICAgIH07XHJcbiAgICAvKiBpZiAoZS50b3VjaGVzICYmIGUudG91Y2hlcy5sZW5ndGgpIHtcclxuICAgICAgY29vcmRzLmlzVG91Y2ggPSB0cnVlO1xyXG4gICAgICBjb29yZHMueCA9IGUudG91Y2hlc1swXS5wYWdlWDtcclxuICAgICAgY29vcmRzLnkgPSBlLnRvdWNoZXNbMF0ucGFnZVk7XHJcbiAgICB9ICovXHJcblxyXG4gICAgLyogdHJ5IG5ldyB3YXkgPSkpICovXHJcbiAgICBlLnRvdWNoZXMgJiZcclxuICAgICAgZS50b3VjaGVzLmxlbmd0aCAmJlxyXG4gICAgICAoKGNvb3Jkcy5pc1RvdWNoID0gdHJ1ZSksIChjb29yZHMueCA9IGUudG91Y2hlc1swXS5wYWdlWCksIChjb29yZHMueSA9IGUudG91Y2hlc1swXS5wYWdlWSkpO1xyXG4gICAgcmV0dXJuIGNvb3JkcztcclxuICB9O1xyXG5cclxuICBpc0NsaWNrID0gKGN1cnJYOiBudW1iZXIsIGN1cnJZOiBudW1iZXIpOiBib29sZWFuID0+IHtcclxuICAgIGNvbnN0IHsgaXNUb3VjaCwgeCwgeSB9ID0gdGhpcy5pbml0aWFsRXZlbnREYXRhO1xyXG4gICAgcmV0dXJuICFpc1RvdWNoICYmIE1hdGguYWJzKGN1cnJYIC0geCkgPD0gdGhpcy5jbGlja1RvbGVyYW5jZSAmJiBNYXRoLmFicyhjdXJyWSAtIHkpIDw9IHRoaXMuY2xpY2tUb2xlcmFuY2U7XHJcbiAgfTtcclxuXHJcbiAgdG91Y2hFZGdlcyA9ICh4OiBudW1iZXIsIHk6IG51bWJlcik6IHsgdG91Y2g6IGJvb2xlYW47IGRpcjogc3RyaW5nIHwgbnVsbCB9ID0+IHtcclxuICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gdGhpcy5nZXRCb3VuZGluZ1JlY3QodGhpcy5ub2RlKTtcclxuXHJcbiAgICBjb25zdCBhZnRlclg6IG51bWJlciA9IHggLSB0aGlzLm9yaWdEaXN0YW5jZUZyb21YVG9Ob2RlO1xyXG4gICAgY29uc3QgYWZ0ZXJZOiBudW1iZXIgPSB5IC0gdGhpcy5vcmlnRGlzdGFuY2VGcm9tWVRvTm9kZTtcclxuXHJcbiAgICBpZiAoYWZ0ZXJYIDwgMCkge1xyXG4gICAgICByZXR1cm4geyB0b3VjaDogdHJ1ZSwgZGlyOiBESVJFQ1RJT04uTEVGVCB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGFmdGVyWCArIHdpZHRoID4gdGhpcy5jdXJyZW50V2luZG93V2lkdGgpIHtcclxuICAgICAgcmV0dXJuIHsgdG91Y2g6IHRydWUsIGRpcjogRElSRUNUSU9OLlJJR0hUIH07XHJcbiAgICB9XHJcbiAgICBpZiAoYWZ0ZXJZIDwgMCkge1xyXG4gICAgICByZXR1cm4geyB0b3VjaDogdHJ1ZSwgZGlyOiBESVJFQ1RJT04uVE9QIH07XHJcbiAgICB9XHJcbiAgICBpZiAoYWZ0ZXJZICsgaGVpZ2h0ID4gdGhpcy5jdXJyZW50V2luZG93SGVpZ2h0KSB7XHJcbiAgICAgIHJldHVybiB7IHRvdWNoOiB0cnVlLCBkaXI6IERJUkVDVElPTi5CT1RUT00gfTtcclxuICAgIH1cclxuICAgIHJldHVybiB7IHRvdWNoOiBmYWxzZSwgZGlyOiBudWxsIH07XHJcbiAgfTtcclxuXHJcbiAgY2FsY0dyaWRNb3ZlbWVudCA9IChjdXJyUG9zaXRpb246IG51bWJlcikgPT4ge1xyXG4gICAgcmV0dXJuIE1hdGguZmxvb3IoY3VyclBvc2l0aW9uIC8gdGhpcy5ncmlkTW92ZW1lbnQpICogdGhpcy5ncmlkTW92ZW1lbnQ7XHJcbiAgfTtcclxuICAvKiBoYW5kbGluZyBldmVudCAqL1xyXG5cclxuICAvKiBJbnNwaXJlIGJ5IEV2ZW50RW1paXRlciwgdHVybnNvdXQgaXQncyBQdWJTdWIgcGF0dGVybiAqL1xyXG4gIG9uID0gKHR5cGU6IHN0cmluZywgaGFuZGxlcjogRnVuY3Rpb24pOiB7IG9mZjogRnVuY3Rpb24gfSA9PiB7XHJcbiAgICBsZXQgaWR4OiBudW1iZXIgPSAodGhpcy5saXN0ZW5lcnNbdHlwZV0gfHwgKHRoaXMubGlzdGVuZXJzW3R5cGVdID0gW10pKS5wdXNoKGhhbmRsZXIpIC0gMTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG9mZigpIHtcclxuICAgICAgICB0aGlzLmxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaWR4LCAxKTtcclxuICAgICAgfSxcclxuICAgIH07XHJcbiAgfTtcclxuXHJcbiAgZW1pdCA9ICh0eXBlOiBzdHJpbmcsIC4uLmFyZ3M6IGFueSk6IHZvaWQgPT4ge1xyXG4gICAgKHRoaXMubGlzdGVuZXJzW3R5cGVdIHx8IFtdKS5mb3JFYWNoKChmbikgPT4ge1xyXG4gICAgICBmbiguLi5hcmdzKTtcclxuICAgIH0pO1xyXG4gIH07XHJcbiAgLyogSW5zcGlyZSBieSBFdmVudEVtaWl0ZXIsIHR1cm5zb3V0IGl0J3MgUHViU3ViIHBhdHRlcm4gKi9cclxufVxyXG5leHBvcnQgZGVmYXVsdCBQb2ludEVtaXR0ZXI7XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBd0JBO0FBNEJBO0FBQUE7QUFBQTtBQTNCQTtBQUNBO0FBRUE7QUFHQTtBQWtDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFTQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXhSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFtQkE7QUFEQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFDQTs7O0FBQUE7QUF1UEE7QUFBQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///0\n')}]).default}));